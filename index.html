<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MOON IDLE — 달 탐사 로켓 제작소</title>
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
<style>
/* ===== DESIGN TOKENS (v7a 기준) =====
 *  --bg         #010800  배경
 *  --panel-bg   #020d04  패널 배경
 *  --green      #00e676  활성 텍스트·테두리
 *  --green-dim  #1a5c34  비활성 테두리·헤더
 *  --green-mid  #00994d  서브 텍스트·레이트
 *  --amber      #ffab00  돈·경고
 *  --red        #ff1744  에러·크리티컬
 *  --white      #c8ffd4  강조 텍스트
 * ======================================= */
:root {
  --bg: #010800;
  --panel-bg: #020d04;
  --green: #00e676;
  --green-dim: #1a5c34;
  --green-mid: #00994d;
  --amber: #ffab00;
  --red: #ff1744;
  --white: #c8ffd4;
  --font: 'Share Tech Mono', monospace;
  --border: 1px solid #1a5c34;
  --glow: 0 0 6px #00e67680;
  --glow-strong: 0 0 12px #00e676, 0 0 24px #00e67650;
  --amber-glow: 0 0 8px #ffab0080;
  /* 추가 토큰 */
  --amber-dim: #7a5100;
  --green-deep: #0a1a0a;
  --text-muted: #6a8a6a;
  --locked: #1a3a1a;
  /* 월드 건물 배경 토큰 */
  --building-bg: #060f08;
  --building-bg-dark: #0a1808;
  --building-bg-darker: #0a1a08;
  --building-roof: #0a2010;
  --building-window: #0a1a10;
  --building-special: #081408;
  --solar-bg: #060f20;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html, body { width: 100%; height: 100%; overflow: hidden; background: var(--bg); color: var(--green); font-family: var(--font); font-size: 15px; }

/* CRT scanlines */
body::before {
  content: '';
  position: fixed; inset: 0; z-index: 9999; pointer-events: none;
  background: repeating-linear-gradient(to bottom, transparent 0px, transparent 2px, rgba(0,0,0,0.12) 2px, rgba(0,0,0,0.12) 4px);
}
/* CRT vignette */
body::after {
  content: '';
  position: fixed; inset: 0; z-index: 9998; pointer-events: none;
  background: radial-gradient(ellipse at center, transparent 55%, rgba(0,0,0,0.65) 100%);
}

@keyframes crt-flicker {
  0%,90%,94%,100% { opacity: 1; }
  91% { opacity: 0.93; } 92% { opacity: 1; }
  95% { opacity: 0.88; } 96% { opacity: 1; }
}

/* Scrollbars */
::-webkit-scrollbar { width: 4px; height: 4px; }
::-webkit-scrollbar-track { background: var(--bg); }
::-webkit-scrollbar-thumb { background: var(--green-dim); }
* { scrollbar-width: thin; scrollbar-color: var(--green-dim) transparent; }

/* ===========================
   CURSOR CONVENTIONS
   =========================== */
/* 클릭 가능한 모든 버튼 — 포인터(손가락) 커서 */
button:not(:disabled) { cursor: pointer; }
/* 드래그 가능 영역 — 손바닥 커서 (생산 탭 월드 씬은 별도 룰에서 재정의) */
[draggable="true"] { cursor: grab; }
[draggable="true"]:active { cursor: grabbing; }

/* ===========================
   TITLE SCREEN
   =========================== */
#title-screen {
  position: fixed; inset: 0; z-index: 5000;
  background: var(--bg);
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  gap: 16px; padding: 24px;
}
.title-logo { font-size: 52px; letter-spacing: 12px; color: var(--green); text-shadow: var(--glow-strong); margin-bottom: 6px; text-align: center; text-transform: uppercase; }
.title-subtitle { font-size: 14px; letter-spacing: 4px; color: var(--green-mid); text-transform: uppercase; text-align: center; }
#boot-log { width: 100%; max-width: 540px; height: 200px; overflow-y: auto; border: var(--border); background: var(--panel-bg); padding: 10px 14px; font-size: 13px; color: var(--green-mid); line-height: 1.6; }
.boot-line { display: block; }
#save-strip { font-size: 13px; color: var(--green-dim); letter-spacing: 2px; border: var(--border); padding: 5px 14px; max-width: 540px; width: 100%; text-align: center; }
.title-btns { display: flex; gap: 12px; flex-wrap: wrap; justify-content: center; margin-top: 4px; }
.title-btn { background: none; border: 2px solid var(--green-dim); color: var(--green); font-family: var(--font); font-size: 15px; letter-spacing: 3px; padding: 9px 28px; cursor: pointer; text-transform: uppercase; transition: all 0.15s; }
.title-btn:hover { border-color: var(--green); text-shadow: var(--glow); }
.title-btn.primary { border-color: var(--green); text-shadow: var(--glow); }
/* Continue button — amber emphasis */
#continue-btn { border-color: var(--amber); color: var(--amber); text-shadow: var(--amber-glow); }
#continue-btn:hover { background: rgba(255,171,0,0.1); border-color: #ffc300; }
/* Settings button on title screen */
.title-settings { margin-top: 8px; }
.title-btn-sm { background: none; border: 1px solid var(--green-dim); color: var(--green-dim); font-family: var(--font); font-size: 11px; letter-spacing: 2px; padding: 4px 12px; cursor: pointer; text-transform: uppercase; transition: all 0.15s; }
.title-btn-sm:hover { border-color: var(--green); color: var(--green); }
@keyframes title-fade-out { from { opacity: 1; } to { opacity: 0; pointer-events: none; } }
.fade-out { animation: title-fade-out 0.8s ease forwards; pointer-events: none; }

/* ===========================
   SAVE SLOT MODAL
   =========================== */
#save-slot-modal {
  display: none; position: fixed; inset: 0; z-index: 6000;
  background: rgba(1,8,0,0.88); align-items: center; justify-content: center;
}
.ssm-box {
  background: var(--panel-bg); border: 2px solid var(--green-dim);
  padding: 28px 32px; min-width: 480px; max-width: 560px; width: 90%;
  display: flex; flex-direction: column; gap: 16px;
}
.ssm-title {
  font-size: 17px; letter-spacing: 4px; text-transform: uppercase;
  color: var(--white); text-shadow: var(--glow); border-bottom: 1px solid var(--green-dim);
  padding-bottom: 10px;
}
.ssm-warn-title { color: var(--amber); text-shadow: var(--amber-glow); }
.ssm-slots { display: flex; flex-direction: column; gap: 10px; }
.ssm-slot {
  border: 1px solid var(--green-dim); padding: 12px 16px; cursor: pointer;
  transition: border-color 0.15s, background 0.15s;
}
.ssm-slot:not(.ssm-disabled):hover { border-color: var(--green); background: rgba(0,230,118,0.06); }
.ssm-slot.ssm-disabled { opacity: 0.38; cursor: default; }
.ssm-slot-num { font-size: 12px; letter-spacing: 3px; color: var(--green-mid); margin-bottom: 4px; }
.ssm-slot-info { font-size: 13px; color: var(--white); }
.ssm-slot-date { font-size: 11px; color: var(--green-dim); margin-top: 2px; }
.ssm-slot-action { font-size: 12px; color: var(--green); margin-top: 6px; letter-spacing: 2px; }
.ssm-slot-action.ssm-warn { color: var(--amber); }
.ssm-cancel {
  background: none; border: 1px solid var(--green-dim); color: var(--green-mid);
  font-family: var(--font); font-size: 13px; letter-spacing: 2px; padding: 7px 18px;
  cursor: pointer; align-self: flex-end; transition: all 0.15s;
}
.ssm-cancel:hover { border-color: var(--green); color: var(--green); }
.ssm-confirm-text { font-size: 14px; color: var(--green-mid); line-height: 1.7; }
.ssm-confirm-btns { display: flex; gap: 12px; justify-content: flex-end; }
.ssm-btn {
  background: none; border: 1px solid var(--green-dim); color: var(--green-mid);
  font-family: var(--font); font-size: 13px; letter-spacing: 2px; padding: 7px 18px;
  cursor: pointer; transition: all 0.15s;
}
.ssm-btn:hover { border-color: var(--green); color: var(--green); }
.ssm-btn-warn { border-color: var(--amber); color: var(--amber); }
.ssm-btn-warn:hover { background: rgba(255,171,0,0.12); }

/* ===========================
   APP WRAPPER
   =========================== */
#app {
  position: relative;
  z-index: 10;
  display: none;
  flex-direction: column;
  height: 100vh;
  overflow: hidden;
  animation: crt-flicker 10s infinite;
}
#app.visible { display: flex; }

/* ===========================
   TOP BAR
   =========================== */
#topbar {
  height: 42px;
  flex-shrink: 0;
  background: var(--panel-bg);
  border-bottom: 2px solid var(--green-dim);
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 0 16px;
  font-size: 14px;
  white-space: nowrap;
  overflow: hidden;
}
#topbar .logo { color: var(--green); font-size: 17px; font-weight: bold; letter-spacing: 1px; }
#topbar .sep  { color: var(--green-dim); }
#topbar .clk  { color: var(--white); font-size: 13px; min-width: 72px; }
#topbar .mny  { color: var(--amber); font-size: 17px; font-weight: bold; }
#topbar .sys  { color: var(--green-mid); font-size: 12px; }
#topbar .tb-r { display: flex; align-items: center; gap: 8px; margin-left: auto; flex-shrink: 0; }

/* ===========================
   MAIN ROW
   =========================== */
#main { flex: 1; display: flex; overflow: hidden; }

/* ===========================
   LEFT PANEL
   =========================== */
#res-left {
  width: 22%;
  min-width: 200px;
  max-width: 270px;
  background: var(--panel-bg);
  border-right: 1px solid var(--green-dim);
  overflow-y: auto;
  overflow-x: hidden;
  flex-shrink: 0;
  padding: 8px;
  font-size: 13px;
}
#res-left::-webkit-scrollbar { width: 3px; }
/* Section header */
.sh { color: var(--green-dim); font-size: 11px; letter-spacing: 2px; padding: 7px 4px 3px; border-bottom: 1px solid var(--green-dim); margin-bottom: 5px; text-transform: uppercase; }
/* Resource category headers */
.rl-cat-hd { font-size:10px; letter-spacing:2px; color:var(--green-dim); padding:6px 2px 2px; border-bottom:1px solid var(--green-deep); margin-bottom:3px; }
/* Resource items — horizontal layout */
.rl-item { padding:4px 2px 2px; margin-bottom:2px; border-bottom:1px solid var(--green-deep); }
.rl-row { display:flex; align-items:center; gap:4px; }
.rl-sym { font-size:10px; min-width:22px; flex-shrink:0; font-weight:bold; }
.rl-name { color:var(--green-mid); font-size:11px; flex:1; }
.rl-val { font-size:13px; font-weight:bold; min-width:44px; text-align:right; }
.rl-rate { color:var(--green-dim); font-size:10px; min-width:46px; text-align:right; }
.rl-worker-row { border-top:1px solid var(--green-dim); margin-top:3px; padding-top:5px; }
.rl-bar { height:3px; background:var(--panel-bg); margin-top:2px; border-radius:2px; overflow:hidden; }
.rl-bar-fill { height:100%; background:var(--green-mid); transition:width 0.8s; border-radius:2px; }
.rl-bar-fill.amber { background:var(--amber); }
.rl-ms-row { margin-top: 8px; padding: 6px 4px; border: 1px solid var(--amber-dim); background: rgba(255,171,0,0.05); }
.rl-ms-label { color: var(--amber-dim); font-size: 11px; letter-spacing: 1px; }
.rl-ms-val { color: var(--amber); font-size: 16px; font-weight: bold; }

/* ===========================
   WORLD WRAPPER (tab-area만 포함)
   =========================== */
#ww { flex: 1; display: flex; flex-direction: column; overflow: hidden; min-width: 0; }

/* ===========================
   WORLD — 고정 전체화면 배경 레이어
   =========================== */
#world-bg {
  position: fixed;
  inset: 0;
  z-index: 0;
  overflow-x: auto;
  overflow-y: hidden;
  background: linear-gradient(to bottom, #000508 0%, #000d04 18%, #011505 38%, #010d03 60%, #010900 80%, var(--bg) 100%);
  /* 기본: 비생산 탭에서는 흐릿하게 */
  opacity: 0.15;
  filter: blur(2px) brightness(0.5);
  transition: opacity 0.5s, filter 0.5s;
  pointer-events: none;
}
/* P4-4: 생산 탭에서는 완전 선명 + 스크롤 + 드래그 가능 (월드 씬 주인공) */
body.tab-production #world-bg {
  opacity: 1.0;
  filter: none;
  pointer-events: auto;
  cursor: grab;
  overflow-x: auto;
  overflow-y: hidden;
}
body.tab-production #world-bg:active { cursor: grabbing; }
/* 발사 통제 탭에서는 좌측 자원 패널 + 우측 인원 패널 숨김 */
body.tab-launch #res-left { display: none; }
body.tab-launch #rp { display: none; }
#world-bg::-webkit-scrollbar { height: 6px; }
#world-bg::-webkit-scrollbar-track { background: var(--bg); border-top: 1px solid var(--green-dim); }
#world-bg::-webkit-scrollbar-thumb { background: var(--green-dim); border-radius: 3px; }

#world-scene {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 3200px;
  height: 220px;
}
#sky-layer { position: absolute; top: 0; left: 0; width: 100%; height: 160px; }
.star { position: absolute; width: 2px; height: 2px; background: var(--green-dim); opacity: 0.6; }
#buildings-layer { position: absolute; bottom: 32px; left: 0; width: 100%; }
#ground-line { position: absolute; bottom: 0; left: 0; width: 100%; height: 32px; background: linear-gradient(to bottom, #0a1a08, #020d04); border-top: 2px solid var(--green-dim); }
#workers-layer { position: absolute; bottom: 32px; left: 0; width: 100%; }

/* World buildings */
.world-building { position: absolute; bottom: 0; }
.wb-mine { width: 70px; height: 85px; background: var(--building-bg-dark); border: 2px solid var(--green-dim); border-bottom: none; position: relative; }
.wb-mine::before { content: ''; position: absolute; top: -8px; left: 10px; right: 10px; height: 8px; background: var(--building-roof); border: 2px solid var(--green-dim); border-bottom: none; }
.wb-mine .conveyor { position: absolute; bottom: 20px; right: -20px; width: 22px; height: 8px; background: var(--building-bg-darker); border: 1px solid var(--green-dim); transform: rotate(-20deg); }
.mine-light { position: absolute; top: 6px; right: 8px; width: 6px; height: 6px; background: var(--amber); box-shadow: 0 0 6px var(--amber); animation: mine-blink 2s step-start infinite; }
@keyframes mine-blink { 0%,100% { opacity: 1; } 50% { opacity: 0.2; } }
.wb-refinery { width: 100px; height: 100px; display: flex; align-items: flex-end; gap: 6px; position: absolute; bottom: 0; }
.refinery-tank { width: 40px; background: var(--building-special); border: 2px solid var(--green-dim); border-bottom: none; position: relative; }
.refinery-tank.tall { height: 90px; }
.refinery-tank.short { height: 65px; }
.refinery-tank::before { content: ''; position: absolute; top: -6px; left: -2px; right: -2px; height: 6px; background: var(--building-bg-darker); border: 2px solid var(--green-dim); }
.wb-research { width: 110px; height: 75px; background: var(--building-bg); border: 2px solid var(--green-dim); border-bottom: none; position: relative; }
.wb-research::before { content: ''; position: absolute; top: -10px; left: 30px; right: 30px; height: 10px; background: var(--building-bg-dark); border: 2px solid var(--green-dim); border-bottom: none; }
.research-windows { position: absolute; top: 10px; left: 6px; right: 6px; display: flex; flex-wrap: wrap; gap: 4px; }
.research-win { width: 16px; height: 14px; background: var(--building-window); border: 1px solid var(--green-dim); }
.research-win.lit { background: var(--green-dim); box-shadow: 0 0 4px var(--green-dim); }
.wb-ops { width: 90px; height: 70px; background: var(--building-bg); border: 2px solid var(--green-dim); border-bottom: none; position: relative; }
.ops-windows { position: absolute; top: 8px; left: 4px; right: 4px; display: flex; flex-wrap: wrap; gap: 3px; }
.ops-win { width: 14px; height: 12px; background: var(--building-window); border: 1px solid var(--green-dim); }
.ops-win.lit { background: var(--green-dim); }
.ops-sign { position: absolute; bottom: 6px; left: 50%; transform: translateX(-50%); width: 40px; height: 6px; background: var(--green-dim); opacity: 0.6; }
.wb-eleclab { width: 90px; height: 70px; background: var(--building-bg); border: 2px solid var(--green-dim); border-bottom: none; position: relative; }
.wb-solar { display: flex; align-items: flex-end; gap: 8px; position: absolute; bottom: 0; }
.solar-pole { width: 4px; height: 50px; background: var(--green-dim); }
.solar-panel { width: 30px; height: 20px; background: var(--solar-bg); border: 1px solid var(--green-dim); position: relative; top: -30px; }
.wb-launchpad { width: 80px; height: 110px; position: absolute; bottom: 0; }
.lp-gantry { position: absolute; top: 0; left: 10px; width: 4px; height: 80px; background: var(--green-dim); }
.lp-rocket { position: absolute; top: 10px; left: 16px; width: 20px; height: 60px; background: var(--building-roof); border: 1px solid var(--green); }
.lp-base { position: absolute; bottom: 0; left: 0; width: 80px; height: 16px; background: var(--building-bg-darker); border: 2px solid var(--green-dim); }

/* ===========================
   NAV TABS
   =========================== */
#nav-tabs {
  flex-shrink: 0;
  display: flex;
  border-bottom: var(--border);
  background: var(--panel-bg);
}
.nav-tab {
  flex: 0 0 auto;
  min-width: 90px;
  padding: 9px 18px;
  background: none;
  border: none;
  border-bottom: 3px solid transparent;
  color: var(--green-dim);
  font-family: var(--font);
  font-size: 13px;
  letter-spacing: 1px;
  cursor: pointer;
  text-transform: uppercase;
  transition: all 0.15s;
  text-align: center;
  border-right: var(--border);
}
.nav-tab:last-child { border-right: none; }
.nav-tab:hover { color: var(--green); }
.nav-tab.active { color: var(--green); border-bottom-color: var(--green); text-shadow: var(--glow-strong); background: rgba(0,230,118,0.04); }
.nav-tab.new-unlock { animation: tab-unlock 0.8s ease; }
@keyframes tab-unlock { 0% { color: var(--amber); text-shadow: 0 0 20px var(--amber); } 100% { color: var(--green); } }

/* ── Tab Unlock Flash Banner ── */
#tab-unlock-flash { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 9999; pointer-events: none; text-align: center; }
#tab-unlock-flash.tuf-hidden { display: none; }
#tab-unlock-flash.tuf-visible { display: block; animation: tuf-in 0.3s ease, tuf-out 0.5s ease 2.1s forwards; }
.tuf-inner { background: rgba(0,0,0,0.92); border: 1px solid var(--amber); padding: 28px 48px; box-shadow: 0 0 60px rgba(255,171,0,0.3), inset 0 0 30px rgba(255,171,0,0.05); }
.tuf-top  { font-size: 11px; color: var(--amber-dim); letter-spacing: 4px; margin-bottom: 10px; }
.tuf-main { font-size: 28px; color: var(--amber); letter-spacing: 6px; text-shadow: 0 0 30px var(--amber), 0 0 60px rgba(255,171,0,0.5); margin-bottom: 8px; animation: tuf-pulse 0.6s ease infinite alternate; }
.tuf-sub  { font-size: 12px; color: var(--green-mid); letter-spacing: 4px; }
@keyframes tuf-in  { 0% { opacity:0; transform:scale(0.85); } 100% { opacity:1; transform:scale(1); } }
@keyframes tuf-out { 0% { opacity:1; } 100% { opacity:0; } }
@keyframes tuf-pulse { 0% { text-shadow: 0 0 20px var(--amber); } 100% { text-shadow: 0 0 40px var(--amber), 0 0 80px rgba(255,171,0,0.6); } }

/* ===========================
   OFFLINE BANNER
   =========================== */
#offline-banner {
  display: none;
  background: rgba(255,171,0,0.08);
  border-bottom: 1px solid var(--amber);
  color: var(--amber);
  padding: 6px 14px;
  font-size: 13px;
  flex-shrink: 0;
}

/* ===========================
   TAB CONTENT AREA
   =========================== */
#tab-area { flex: 1; overflow-y: auto; }
.tab-pane { display: none; padding: 14px 12px; }
.tab-pane.active { display: block; }

/* Panels */
.panel { background: rgba(2,13,4,0.96); border: var(--border); padding: 12px 16px; margin-bottom: 12px; }
.panel-header { font-size: 15px; letter-spacing: 3px; color: var(--green); text-transform: uppercase; border-bottom: var(--border); padding-bottom: 8px; margin-bottom: 10px; text-shadow: var(--glow); }
.panel-header::before { content: '// '; }

/* Buttons */
.btn { background: none; border: 2px solid var(--green-dim); color: var(--green); font-family: var(--font); font-size: 14px; letter-spacing: 1px; padding: 7px 14px; cursor: pointer; text-transform: uppercase; transition: all 0.12s; }
.btn:hover:not(:disabled) { border-color: var(--green); text-shadow: var(--glow); }
.btn:disabled { opacity: 0.3; cursor: not-allowed; }
.btn-amber { border-color: var(--amber); color: var(--amber); }
.btn-sm { font-size: 12px; padding: 4px 10px; letter-spacing: 0; }
.btn-full { display: block; width: 100%; text-align: center; margin-top: 8px; }

/* v7a overlay button style */
.obtn { padding: 5px 11px; border: 1px solid var(--green); color: var(--green); cursor: pointer; font-family: var(--font); font-size: 13px; background: transparent; transition: background .13s, color .13s; white-space: nowrap; }
.obtn:hover { background: var(--green); color: var(--bg); }
.obtn.a { border-color: var(--amber); color: var(--amber); }
.obtn.a:hover { background: var(--amber); color: var(--bg); }
.obtn.off { opacity: .35; cursor: not-allowed; pointer-events: none; }

/* Sound button */
#sound-btn { background: none; border: 1px solid var(--green-dim); color: var(--green-dim); font-family: var(--font); font-size: 12px; letter-spacing: 1px; padding: 3px 8px; cursor: pointer; text-transform: uppercase; transition: all 0.12s; }
#sound-btn:hover { color: var(--green); border-color: var(--green); }
#bgm-prev-btn { font-size: 11px; padding: 3px 7px; border: 1px solid var(--green-dim); background: transparent; color: var(--green-mid); cursor: pointer; font-family: var(--font); transition: all 0.12s; }
#bgm-prev-btn:hover { color: var(--green); border-color: var(--green); }
#lang-btn { font-size: 11px; padding: 3px 8px; border: 1px solid var(--amber); background: transparent; color: var(--amber); cursor: pointer; font-family: var(--font); letter-spacing: 1px; transition: all 0.12s; }
#lang-btn:hover { color: #ffe080; border-color: #ffe080; }
#bgm-track-label { font-size: 11px; color: var(--green-dim); min-width: 80px; }

/* Progress bars */
.prog-wrap { border: 1px solid var(--green-dim); height: 10px; background: var(--bg); overflow: hidden; margin: 6px 0 3px; }
.prog-fill { height: 100%; background: var(--green-mid); transition: width 0.3s; }
.prog-fill.amber { background: var(--amber); box-shadow: 0 0 4px rgba(255,171,0,0.5); }
.prog-pct  { font-size: 11px; color: var(--green-mid); text-align: right; }

/* Notifications */
#notif { position: fixed; bottom: 40px; right: 20px; z-index: 8000; display: flex; flex-direction: column; gap: 7px; pointer-events: none; }
.notif-item { background: var(--panel-bg); border: 1px solid var(--green-dim); color: var(--green); font-size: 13px; padding: 7px 14px; text-shadow: var(--glow); animation: notif-in 0.2s ease, notif-out 0.4s ease 2.6s forwards; max-width: 320px; }
.notif-item.amber { border-color: var(--amber); color: var(--amber); }
.notif-item.red { border-color: var(--red); color: var(--red); }
@keyframes notif-in { from { opacity: 0; transform: translateX(40px); } to { opacity: 1; transform: none; } }
@keyframes notif-out { to { opacity: 0; transform: translateX(40px); } }

/* ===========================
   RIGHT PANEL
   =========================== */
#rp {
  width: 155px;
  background: var(--panel-bg);
  border-left: 1px solid var(--green-dim);
  overflow-y: auto;
  flex-shrink: 0;
  padding: 8px 6px;
  font-size: 12px;
}
#rp::-webkit-scrollbar { width: 3px; }
#rp::-webkit-scrollbar-thumb { background: var(--green-dim); }
.rph { color: var(--green-dim); font-size: 11px; letter-spacing: 2px; padding-bottom: 4px; border-bottom: 1px solid var(--green-dim); margin-bottom: 6px; text-transform: uppercase; }
.strow { padding: 4px 2px; border-bottom: 1px solid rgba(26,92,52,.4); margin-bottom: 4px; }
.stn { color: var(--white); font-size: 12px; }
.stl { color: var(--green-mid); font-size: 11px; margin-top: 1px; }
.sts { font-size: 11px; margin-top: 1px; }
.gbar { height: 5px; background: var(--green-dim); margin-top: 3px; border-radius: 2px; overflow: hidden; }
.gfill { height: 100%; background: var(--green); border-radius: 2px; transition: width 0.9s ease; }
.gfill.a { background: var(--amber); }

/* ===========================
   TICKER
   =========================== */
#ticker {
  flex-shrink: 0;
  background: var(--panel-bg);
  border-top: 1px solid var(--green-dim);
  height: 30px;
  display: flex;
  align-items: center;
  padding: 0 14px;
  font-size: 12px;
  color: var(--green-mid);
  white-space: nowrap;
  overflow: hidden;
}
#tki { display: inline-block; animation: tkrun 45s linear infinite; }
@keyframes tkrun { 0% { transform: translateX(100vw); } 100% { transform: translateX(-100%); } }
.tw { color: var(--amber); }
.to { color: var(--green); }
.ts { color: var(--green-dim); margin: 0 20px; }

/* ===========================
   ASCII WORLD BUILDINGS
   =========================== */
.world-bld {
  position: absolute;
  bottom: 0;
  font-family: var(--font);
  font-size: 11px;
  line-height: 1.25;
  color: var(--green-dim);
  white-space: pre;
  cursor: pointer;
  user-select: none;
  padding: 0;
  text-shadow: 0 0 4px rgba(0,230,118,0.25);
  transition: color 0.2s, opacity 0.2s, filter 0.2s, text-shadow 0.15s;
}
.world-bld:hover { color: var(--green); text-shadow: 0 0 10px #00e67680; }
.world-bld.active-bld { color: var(--green); text-shadow: 0 0 8px #00e67680; }

/* ── Building state classes ── */
.world-bld.wb-state-ghost  { opacity: 0.38; color: #1a3020; cursor: pointer; animation: ghost-pulse 3s ease-in-out infinite; }
.world-bld.wb-state-ghost:hover { opacity: 0.65; color: var(--green-dim); animation: none; }
@keyframes ghost-pulse { 0%,100% { opacity:0.30; } 50% { opacity:0.50; } }
.world-bld.wb-state-idle   { opacity: 0.60; color: #2a5a38; }
.world-bld.wb-state-active { opacity: 1; color: var(--green); text-shadow: 0 0 8px rgba(0,230,118,0.55); }
.world-bld.wb-state-active:hover { text-shadow: 0 0 16px #00e676cc; }
.world-bld.wb-state-idle:hover { pointer-events: auto; opacity: 0.75; }
/* ── Build & Upgrade Animations ── */
@keyframes wb-build {
  0%   { opacity:0; transform:scaleY(0.15) translateY(18px); filter:blur(5px); }
  40%  { opacity:0.8; filter:blur(1px); }
  70%  { transform:scaleY(1.06) translateY(-3px); }
  100% { opacity:1; transform:scaleY(1) translateY(0); filter:blur(0); }
}
.world-bld.wb-anim-build { animation: wb-build 0.85s cubic-bezier(0.22,1,0.36,1) forwards !important; }
@keyframes wb-upgrade {
  0%   { filter:brightness(1); }
  25%  { filter:brightness(3) saturate(2); color:var(--amber); text-shadow:0 0 18px var(--amber); }
  55%  { transform:scale(1.06); filter:brightness(2); }
  100% { filter:brightness(1); transform:scale(1); }
}
.world-bld.wb-anim-upgrade { animation: wb-upgrade 0.7s ease-out forwards !important; }

/* ── Add-on buildings ── */
.world-bld.wb-addon         { color: var(--amber); text-shadow: 0 0 6px rgba(255,171,0,0.4); }
.world-bld.wb-addon:hover   { color: #ffdd55; text-shadow: 0 0 14px rgba(255,171,0,0.8); }
.world-bld.wb-addon-ph      { opacity: 0.28; animation: addon-pulse 2s ease-in-out infinite; color: var(--amber); }
@keyframes addon-pulse { 0%,100%{opacity:0.2} 50%{opacity:0.4} }

/* ── Building overlay separator label ── */
.bov-sep-label { font-size:10px; color:var(--green-mid); padding:4px 10px 2px; letter-spacing:1px; border-top:1px solid var(--green-deep); margin-top:2px; }

/* Worker dots */
.wkr {
  position: absolute;
  color: var(--green);
  font-size: 11px;
  line-height: 1;
  text-shadow: 0 0 5px var(--green);
  bottom: 6px;
  pointer-events: none;
}

/* ===========================
   BUILDING HOVER OVERLAY
   =========================== */
/* ── Building overlay (2-panel) ── */
#bld-ov { position:fixed; display:none; z-index:9600; background:rgba(1,8,0,0.97); border:1px solid var(--green); box-shadow:0 0 22px rgba(0,230,118,0.18); font-family:var(--font); font-size:12px; color:var(--green); }
.bov-head { display:flex; justify-content:space-between; align-items:center; padding:7px 12px; border-bottom:1px solid var(--green-dim); }
.bov-head-name { color:var(--white); font-size:13px; }
.bov-head-meta { color:var(--green-dim); font-size:11px; }
.bov-body { display:flex; min-height:120px; }
.bov-acts-col { flex:1; border-right:1px solid var(--green-deep); overflow-y:auto; max-height:220px; }
.bov-desc-col { width:180px; flex-shrink:0; padding:10px; }
.bov-desc-hint { color:var(--green-mid); font-size:10px; line-height:1.7; }
.bov-desc-name { color:var(--green); font-size:12px; margin-bottom:5px; font-weight:bold; }
.bov-desc-body { color:var(--green-mid); font-size:11px; line-height:1.7; }
.bov-act { display:flex; align-items:center; gap:6px; padding:6px 10px; border-bottom:1px solid var(--green-deep); cursor:pointer; }
.bov-act:last-child { border-bottom:none; }
.bov-act:hover { background:rgba(0,230,118,0.05); }
.bov-act-label { flex:1; color:var(--white); font-size:12px; }
.bov-done .bov-act-label { color:var(--green-dim); }
.bov-locked .bov-act-label { color:#2a3a2a; }
.bov-need .bov-act-label { color:#2a4a2a; }
/* Worker assign/unassign rows — amber accent */
.bov-act.bov-worker { background:rgba(255,171,0,0.04); border-left:2px solid var(--amber-dim); }
.bov-act.bov-worker:hover { background:rgba(255,171,0,0.09); }
.bov-act.bov-worker .bov-act-label { color:var(--amber); }
.bov-act.bov-worker .bov-act-btn:not(.dis) { border-color:var(--amber); color:var(--amber); }
.bov-act.bov-worker .bov-act-info { color:#a06800; }
.bov-act-btn { padding:2px 7px; font-size:10px; font-family:var(--font); background:transparent; border:1px solid var(--green-dim); color:var(--green-mid); cursor:pointer; white-space:nowrap; }
.bov-act-btn:hover:not(.dis) { border-color:var(--green); color:var(--green); }
.bov-act-btn.dis { border-color:var(--locked); color:var(--locked); cursor:default; }
.bov-act-info { font-size:10px; color:var(--green-dim); white-space:nowrap; }
.bov-act-info.red { color:var(--red); }
.bov-act-empty { padding:10px; color:var(--locked); font-size:11px; }
.bov-foot { padding:6px 10px 8px; border-top:1px solid var(--green-deep); }
.bov-buy-btn { display:block; width:100%; padding:5px 10px; font-family:var(--font); font-size:11px; background:transparent; border:1px solid var(--green-dim); color:var(--green-mid); cursor:pointer; text-align:left; }
.bov-buy-btn:hover:not(.dis) { border-color:var(--green); color:var(--green); }
.bov-buy-btn.dis { opacity:0.4; cursor:default; }
.bov-buy-cost { float:right; color:var(--green-dim); font-size:10px; }

/* ── Tech tooltip (research tab hover) ── */
#tech-tip { position:fixed; display:none; z-index:9700; background:rgba(1,8,0,0.97); border:1px solid var(--green); width:256px; padding:10px 12px; box-shadow:0 0 20px rgba(0,230,118,0.15); font-family:var(--font); font-size:12px; }
.tt-head { display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #0a2a0a; padding-bottom:6px; margin-bottom:6px; }
.tt-head > span:first-child { color:var(--green); font-size:13px; }
.tt-status { font-size:10px; letter-spacing:1px; }
.tt-ok   { color:var(--green); }
.tt-rdy  { color:var(--amber); }
.tt-lock { color:#2a3a2a; }
.tt-need { color:#1a4020; }
.tt-desc { color:var(--green-mid); font-size:11px; margin-bottom:8px; line-height:1.6; }
.tt-sub  { font-size:10px; color:var(--green-dim); letter-spacing:2px; text-transform:uppercase; margin:8px 0 4px; }
.tt-cost-row { display:flex; justify-content:space-between; font-size:11px; color:var(--green-mid); padding:2px 0; }
.tt-row  { font-size:11px; color:var(--green-dim); padding:2px 0; }
.tt-viz  { margin-top:8px; border:1px solid #3a2800; background:rgba(255,171,0,0.04); padding:7px 9px; }
.tt-viz-hd { font-size:10px; color:var(--amber-dim); letter-spacing:2px; margin-bottom:4px; }
.tt-viz-bar { color:var(--amber); font-size:11px; font-family:var(--font); margin:1px 0; }
.tt-viz-stat { color:var(--amber); font-size:12px; margin-top:5px; letter-spacing:1px; text-shadow:var(--amber-glow); }

/* ===========================
   PRODUCTION TAB
   =========================== */
#pane-production.active { display:block; padding:8px 8px 0 0; text-align:right; }
#prod-bld-panel { display:inline-block; text-align:left; width:220px; background:rgba(1,10,2,0.93); border:1px solid var(--green-dim); padding:6px 8px; font-size:11px; vertical-align:top; max-height:calc(100vh - 100px); overflow-y:auto; }
.bld-list-hd { font-size:10px; letter-spacing:2px; color:var(--green-mid); text-transform:uppercase; border-bottom:1px solid var(--green-dim); padding-bottom:4px; margin-bottom:5px; }
#prod-status { font-size:10px; color:var(--green-dim); margin-bottom:5px; padding-bottom:4px; border-bottom:1px solid var(--green-deep); }
.bld-list-row { display:flex; align-items:center; gap:4px; padding:3px 0; border-bottom:1px solid var(--green-deep); }
.blr-icon { color:var(--green-mid); min-width:28px; font-size:10px; }
.blr-name { flex:1; color:var(--white); font-size:10px; white-space:nowrap; overflow:hidden; }
.blr-cnt { color:var(--green-dim); font-size:10px; min-width:18px; text-align:right; }
.blr-rate { font-size:10px; min-width:52px; text-align:right; }
.blr-wkr { display:flex; align-items:center; gap:2px; }
.blr-wkr-empty { min-width:46px; }
.blr-wbtn { background:none; border:1px solid var(--green-dim); color:var(--green-dim); font-family:var(--font); font-size:10px; padding:0 3px; cursor:pointer; line-height:14px; }
.blr-wbtn:hover:not(:disabled) { border-color:var(--green); color:var(--green); }
.blr-wbtn.dis { opacity:0.3; cursor:default; }
.blr-wassign { min-width:14px; text-align:center; font-size:10px; color:var(--white); }
.blr-withdraw-btn { background:none; border:1px solid var(--amber-dim); color:var(--amber-dim); font-family:var(--font); font-size:10px; padding:0 3px; cursor:pointer; }
.blr-withdraw-btn:hover { border-color:var(--amber); color:var(--amber); }
/* Ghost building popup */
.ghost-art-preview { font-size:10px; line-height:1.4; color:var(--green-mid); opacity:0.8; border:1px solid #0a2010; padding:6px 8px; margin:6px 0; white-space:pre; background:rgba(0,10,0,0.4); display:block; }
.ghost-tag { font-size:10px; letter-spacing:2px; color:#1a3020; border:1px solid #1a3020; padding:2px 5px; }

/* ===========================
   ROCKET BUILD TAB (첫 번째 탭 — 우주선 제작 현황)
   =========================== */
.rc-layout { display:flex; gap:14px; align-items:flex-start; }
.rc-art-col { flex-shrink:0; text-align:center; min-width:120px; }
.rc-art-label { font-size:10px; letter-spacing:3px; color:var(--green-dim); margin-bottom:6px; }
.rc-art { font-size:12px; color:var(--green); line-height:1.35; margin:0; text-shadow:0 0 8px rgba(0,230,118,0.5); display:inline-block; text-align:left; }
.rc-phase-badge { font-size:10px; letter-spacing:2px; margin-top:8px; }
.rc-main-col { flex:1; min-width:0; }
.rc-section-hd { font-size:10px; letter-spacing:2px; color:var(--green-mid); border-bottom:1px solid var(--green-dim); padding-bottom:4px; margin-bottom:8px; }
.rc-build-rows { margin-bottom:12px; }
.rc-build-row { display:flex; align-items:center; gap:6px; margin-bottom:4px; }
.rc-bl { color:var(--green-dim); min-width:52px; font-size:10px; letter-spacing:1px; }
.rc-bar { color:var(--green); font-size:11px; flex:1; }
.rc-bv { color:var(--green-mid); font-size:10px; min-width:36px; text-align:right; }
.rc-next-obj { border:1px solid #3a2800; background:rgba(255,171,0,0.05); padding:8px 12px; font-size:12px; color:var(--amber); line-height:1.6; }
.rc-next-obj strong { color:var(--white); }
.rc-phases { display:flex; flex-direction:column; gap:4px; }
.rc-phase-row { display:flex; align-items:center; gap:6px; }
.rc-phase-name { color:var(--green-dim); font-size:10px; letter-spacing:1px; min-width:140px; }
.rc-phase-bar-wrap { flex:1; height:6px; border:1px solid var(--green-dim); background:var(--bg); overflow:hidden; }
.rc-phase-bar-fill { height:100%; background:var(--green-dim); transition:width 0.5s; }
.rc-phase-bar-fill.done { background:var(--green); box-shadow:0 0 4px var(--green); }
.rc-phase-pct { min-width:48px; text-align:right; font-size:10px; letter-spacing:1px; }
.rc-stats-col { flex-shrink:0; min-width:128px; background:var(--panel-bg); border:var(--border); padding:8px 10px; }
.rc-stat-hd { font-size:10px; letter-spacing:3px; color:var(--green-mid); border-bottom:var(--border); padding-bottom:4px; margin-bottom:6px; }
.rc-stat-row { display:flex; justify-content:space-between; font-size:11px; padding:3px 0; border-bottom:1px solid var(--green-deep); gap:4px; }
.rc-sl { color:var(--green-dim); }
.rc-sv { color:var(--green); text-align:right; }

/* ===========================
   RESEARCH TAB
   =========================== */
/* research layout — viewport-based (avoids broken height:100% chain under overflow-y:auto) */
#pane-research.active { padding:8px 0 0 0; }
.rsh-layout { display: flex; gap: 12px; align-items: flex-start; }
.rsh-sidebar { width: 210px; flex-shrink: 0; background: var(--panel-bg); border: var(--border); padding: 10px; }
.rsh-sb-hd { font-size: 10px; letter-spacing: 3px; color: var(--green-mid); text-transform: uppercase; border-bottom: var(--border); padding-bottom: 5px; margin-bottom: 8px; }
.rsh-sb-sub { font-size: 10px; letter-spacing: 2px; color: var(--green-dim); text-transform: uppercase; margin: 10px 0 4px; }
.rsh-stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 4px; margin-bottom: 6px; }
.rsh-stat { border: var(--border); padding: 5px; }
.rsh-stat-full { grid-column: span 2; }
.rsh-stat-l { font-size: 10px; color: var(--green-dim); }
.rsh-stat-v { font-size: 13px; color: var(--green); }
.rsh-src-row, .rsh-recent-row { display: flex; justify-content: space-between; font-size: 11px; color: var(--green-mid); padding: 2px 0; border-bottom: 1px solid var(--green-deep); }
.rsh-empty { font-size: 11px; color: var(--locked); }
.rsh-cards-area { flex: 1; min-width: 0; }
.rsh-tier { margin-bottom: 10px; border: var(--border); }
.rsh-tier-hd { font-size: 10px; letter-spacing: 3px; color: var(--green-mid); background: var(--panel-bg); padding: 6px 10px; text-transform: uppercase; border-bottom: var(--border); }
.rsh-card { border-bottom: 1px solid var(--green-deep); cursor: pointer; transition: background 0.1s; padding: 0 10px; }
.rsh-card:last-child { border-bottom: none; }
.rsh-card:hover { background: rgba(0,230,118,0.03); }
.rsh-card.open { background: rgba(0,200,100,0.05); }
.rsh-card.done .rsh-card-row { opacity: 0.55; }
.rsh-card-row { display: flex; align-items: center; gap: 8px; padding: 8px 0; }
.rsh-icon { color: var(--green-mid); font-size: 12px; min-width: 36px; }
.rsh-name { flex: 1; color: var(--white); font-size: 13px; }
.rsh-pills { display: flex; gap: 4px; flex-wrap: wrap; }
.rsh-cost-ok { font-size: 10px; color: var(--green-dim); }
.rsh-cost-ng { font-size: 10px; color: var(--red); }
.rsh-status { font-size: 10px; min-width: 72px; text-align: right; letter-spacing: 1px; }
.rsh-ok   { color: var(--green); }
.rsh-rdy  { color: var(--amber); }
.rsh-lock { color: #2a3a2a; }
.rsh-need { color: #1a4020; }
.rsh-arrow { font-size: 10px; color: var(--green-dim); min-width: 12px; }
.rsh-expand { padding: 10px 0 14px; border-top: 1px solid #0a2010; }
.rsh-det-desc { font-size: 12px; color: var(--green-mid); margin-bottom: 8px; }
.rsh-det-row { font-size: 11px; color: var(--green-dim); padding: 2px 0; }
.rsh-det-cost { display: flex; justify-content: space-between; font-size: 12px; color: var(--green-mid); padding: 2px 0; }
.rsh-det-sub { font-size: 10px; color: var(--green-dim); letter-spacing: 2px; text-transform: uppercase; margin: 8px 0 4px; }
.rsh-viz-box { margin-top: 10px; border: 1px solid #3a2800; background: rgba(255,171,0,0.04); padding: 8px 10px; }
.rsh-viz-hd { font-size: 10px; color: var(--amber-dim); letter-spacing: 2px; margin-bottom: 5px; }
.rsh-viz-bar { color: var(--amber); font-size: 12px; font-family: var(--font); margin: 2px 0; }
.rsh-viz-stat { color: var(--amber); font-size: 13px; margin-top: 6px; letter-spacing: 1px; text-shadow: var(--amber-glow); }
#panel-right-research { width: 25%; flex-shrink: 0; background: var(--panel-bg); border-left: var(--border); display: flex; flex-direction: column; overflow: hidden; }
.r-panel-header { padding: 8px 12px; background: #041208; border-bottom: var(--border); font-size: 11px; letter-spacing: 3px; text-transform: uppercase; color: var(--green); text-shadow: var(--glow); }
.r-panel-header::before { content: '> '; }
.r-panel-scroll { flex: 1; overflow-y: auto; padding: 10px; }
.res-queue-card { border: var(--border); padding: 8px 10px; margin-bottom: 8px; background: #010f04; }
.rqc-title { font-size: 13px; color: var(--green); text-shadow: var(--glow); margin-bottom: 4px; }
.rqc-sub { font-size: 11px; color: var(--green-dim); letter-spacing: 1px; margin-bottom: 4px; }
.rqc-flash { font-size: 12px; color: var(--amber); text-shadow: var(--amber-glow); animation: pulse-amber 0.5s ease-in-out 3; }
@keyframes pulse-amber { 0%,100% { opacity: 1; } 50% { opacity: 0.4; } }
#tree-container { flex: 1; overflow: auto; padding: 14px; position: relative; }
.branch-headers { display: flex; gap: 4px; margin-bottom: 10px; min-width: 800px; }
.branch-header { flex: 1; text-align: center; padding: 5px; border: var(--border); background: #041208; font-size: 11px; letter-spacing: 2px; text-transform: uppercase; color: var(--green); text-shadow: var(--glow); }
.branch-header.locked { border-color: #1a1f1a; color: #3a4a3a; text-shadow: none; }
#tree-svg { display: block; min-width: 800px; }
.tech-node { cursor: pointer; }
.detail-tech-id { font-size: 11px; letter-spacing: 3px; color: var(--green-dim); text-transform: uppercase; margin-bottom: 2px; }
.detail-tech-name { font-size: 15px; color: var(--green); text-shadow: var(--glow-strong); margin-bottom: 2px; letter-spacing: 1px; }
.detail-divider { border: none; border-top: var(--border); margin: 8px 0; }
.status-badge { display: inline-block; padding: 3px 10px; font-size: 11px; letter-spacing: 2px; text-transform: uppercase; border: 1px solid; margin-bottom: 8px; }
.status-complete { color: var(--green); border-color: var(--green); background: #011a0a; }
.status-available { color: var(--green); border-color: var(--green-mid); background: #010f04; }
.status-locked { color: #3a4a3a; border-color: #2a2f2a; background: #1a1f1a; }
.detail-row { display: flex; justify-content: space-between; font-size: 12px; padding: 3px 0; border-bottom: 1px solid #091608; }
.detail-row .dr-key { color: var(--green-dim); text-transform: uppercase; letter-spacing: 1px; font-size: 11px; }
.detail-row .dr-val { color: var(--green); text-align: right; }
.btn-research { display: block; width: 100%; margin-top: 12px; background: none; border: 2px solid var(--green-mid); color: var(--green); font-family: var(--font); font-size: 14px; letter-spacing: 2px; padding: 9px; cursor: pointer; text-transform: uppercase; transition: all 0.15s; }
.btn-research:hover:not(:disabled) { border-color: var(--green); text-shadow: var(--glow-strong); }
.btn-research:disabled { opacity: 0.3; cursor: not-allowed; }
.rp-section { margin-top: 12px; border-top: 1px solid #0d2016; padding-top: 10px; }
.rp-section-title { font-size: 11px; letter-spacing: 2px; color: var(--green-dim); text-transform: uppercase; margin-bottom: 6px; }
.lab-item { display: flex; justify-content: space-between; font-size: 12px; color: var(--green-mid); padding: 3px 0; border-bottom: 1px solid #091608; }
.lab-item .lab-rate { color: var(--green); text-shadow: var(--glow); }
.overview-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-top: 8px; }
.ov-card { border: var(--border); background: #010f04; padding: 8px; text-align: center; }
.ov-num { font-size: 20px; color: var(--green); text-shadow: var(--glow-strong); line-height: 1.2; }
.ov-num.amber { color: var(--amber); text-shadow: var(--amber-glow); }
.ov-label { font-size: 11px; letter-spacing: 1px; text-transform: uppercase; color: var(--green-dim); margin-top: 2px; }

/* ===========================
   RESEARCH TAB v2 — horizontal card tree
   =========================== */
.rsh-layout2 { display:flex; min-height:calc(100vh - 110px); }
.rsh-tree-area { flex:1; overflow-x:auto; padding:10px 14px; }
.rsh-tier-row { display:flex; align-items:flex-start; gap:0; }
.rsh-tier-col { display:flex; flex-direction:column; gap:6px; min-width:132px; }
.rsh-tier-label2 { font-size:10px; letter-spacing:2px; color:var(--green-mid); text-transform:uppercase; padding:4px 6px; background:var(--panel-bg); border:var(--border); margin-bottom:2px; text-align:center; }
.rsh-tier-arrow { display:flex; align-items:flex-start; justify-content:center; width:26px; padding-top:34px; color:var(--green-dim); font-size:14px; flex-shrink:0; }
.rsh-card2 { border:1px solid var(--green-dim); padding:7px 8px; cursor:pointer; transition:border-color 0.12s,background 0.12s,box-shadow 0.12s; min-height:62px; display:flex; flex-direction:column; gap:3px; background:rgba(1,8,0,0.85); }
.rsh-card2:hover { border-color:var(--green); background:rgba(0,230,118,0.04); }
.rsh-card2.selected { border-color:var(--green); background:rgba(0,230,118,0.07); box-shadow:0 0 8px rgba(0,230,118,0.15); }
.rsh-card2.done { border-color:#1a4a2a; opacity:0.65; }
.rsh-card2.locked { border-color:#0f1a0f; cursor:default; opacity:0.45; }
.rsh-card2.available { animation:node-available-pulse 2s ease-in-out infinite; }
@keyframes node-available-pulse { 0%,100%{box-shadow:0 0 4px rgba(0,153,77,0.3)} 50%{box-shadow:0 0 10px rgba(0,230,118,0.45)} }
.rsh-c2-icon { font-size:14px; }
.rsh-c2-name { color:var(--white); font-size:10px; line-height:1.3; }
.rsh-c2-status { font-size:10px; letter-spacing:1px; margin-top:2px; }
/* Research detail panel (right side) */
.rsh-detail-panel { width:196px; flex-shrink:0; background:var(--panel-bg); border-left:var(--border); overflow-y:auto; padding:10px; }
.rdp-hd { font-size:10px; letter-spacing:3px; color:var(--green-mid); text-transform:uppercase; border-bottom:var(--border); padding-bottom:5px; margin-bottom:8px; }
.rdp-icon { font-size:22px; margin-bottom:4px; }
.rdp-name { font-size:13px; color:var(--green); text-shadow:var(--glow); margin-bottom:2px; }
.rdp-status { font-size:10px; letter-spacing:1px; margin-bottom:8px; }
.rdp-desc { font-size:11px; color:var(--green-mid); line-height:1.6; margin-bottom:8px; }
.rdp-sub { font-size:10px; letter-spacing:2px; color:var(--green-dim); text-transform:uppercase; margin:6px 0 3px; border-top:1px solid var(--green-deep); padding-top:5px; }
.rdp-cost-row { display:flex; justify-content:space-between; font-size:10px; color:var(--green-mid); padding:2px 0; border-bottom:1px solid var(--green-deep); }
.rdp-viz { margin-top:8px; border:1px solid #3a2800; background:rgba(255,171,0,0.04); padding:6px 8px; }
.rdp-viz-hd { font-size:10px; color:var(--amber-dim); letter-spacing:2px; margin-bottom:3px; }
.rdp-viz-bar { color:var(--amber); font-size:10px; margin:1px 0; }
.rdp-viz-stat { color:var(--amber); font-size:11px; margin-top:3px; }
/* P4-5: Research ASCII Art Panel */
.rdp-ascii-panel { margin-top:8px; border:1px solid var(--green-dim); background:#010a02; padding:6px 8px; }
.rdp-ascii-hd { font-size:10px; color:var(--green-dim); letter-spacing:2px; margin-bottom:4px; }
.rdp-ascii-art { font-size:10px; color:var(--green-mid); line-height:1.2; white-space:pre; overflow-x:auto; margin:0; }
.rdp-btn { display:block; width:100%; margin-top:10px; background:none; border:1px solid var(--green-mid); color:var(--green); font-family:var(--font); font-size:12px; letter-spacing:1px; padding:7px; cursor:pointer; text-transform:uppercase; transition:all 0.15s; }
.rdp-btn:hover:not(:disabled) { border-color:var(--green); text-shadow:var(--glow); }
.rdp-btn:disabled { opacity:0.3; cursor:not-allowed; }
.rdp-empty { font-size:11px; color:var(--locked); line-height:1.8; }

/* ===========================
   ASSEMBLY TAB
   =========================== */
/* pane-assembly: flex override는 tab-enter 섹션에서 정의 */
.asm-col { overflow-y: auto; overflow-x: hidden; flex-shrink: 0; }
.asm-col::-webkit-scrollbar { width: 3px; }
.asm-col::-webkit-scrollbar-thumb { background: var(--green-dim); }
.asm-col-left   { flex: 0 0 30%; max-width: 30%; border-right: 1px solid var(--green-dim); background: var(--panel-bg); }
.asm-col-center { flex: 0 0 40%; max-width: 40%; background: var(--bg); }
.asm-col-right  { flex: 0 0 30%; max-width: 30%; border-left: 1px solid var(--green-dim); background: var(--panel-bg); }
.asm-panel { padding: 8px 10px; border-bottom: 1px solid var(--green-dim); }
.asm-pnl-title { color: var(--green-dim); font-size: 10px; letter-spacing: .15em; text-transform: uppercase; margin-bottom: 5px; border-bottom: 1px solid var(--green-dim); padding-bottom: 3px; }
.asm-pnl-title.green { color: var(--green); text-shadow: var(--glow); border-bottom-color: var(--green-mid); }
.asm-pnl-title.amber { color: var(--amber); border-bottom-color: #5a3c00; }

/* 로켓 클래스 선택 그리드 */
.asm-class-grid { display: flex; flex-direction: column; gap: 4px; }
.asm-class-btn { display: flex; align-items: center; gap: 6px; background: none; border: 1px solid var(--green-dim); color: var(--green-dim); font-family: var(--font); font-size: 11px; padding: 6px 8px; cursor: pointer; transition: all 0.15s; letter-spacing: .05em; text-align: left; }
.asm-class-btn:hover:not(:disabled) { border-color: var(--green); color: var(--green); }
.asm-class-btn.selected { border-color: var(--amber); color: var(--amber); box-shadow: 0 0 8px rgba(255,171,0,0.3); }
.asm-class-btn:disabled { opacity: 0.3; cursor: not-allowed; }
.asm-class-btn .asm-radio { display: inline-block; width: 8px; height: 8px; border: 1px solid currentColor; border-radius: 50%; flex-shrink: 0; }
.asm-class-btn.selected .asm-radio { background: var(--amber); }
.asm-class-btn .lock-icon { margin-left: auto; font-size: 10px; color: var(--green-dim); }

/* 기체 스펙 */
.asm-specs-row { display: flex; justify-content: space-between; font-size: 11px; padding: 2px 0; color: #8aaa8a; }
.asm-specs-row .val { color: var(--green); text-shadow: var(--glow); }
.asm-specs-row .val.amber { color: var(--amber); }
.asm-specs-divider { border: none; border-top: 1px solid var(--green-dim); margin: 4px 0; }

/* 기존 로켓 아트/부품/품질/슬롯 스타일 */
.rocket-art-wrap { text-align: center; padding: 10px; border-bottom: 1px solid var(--green-dim); background: var(--bg); min-height: 220px; display: flex; align-items: center; justify-content: center; }
#rocket-art-display { font-size: 12px; white-space: pre; line-height: 1.3; color: var(--green-dim); }
#rocket-art-display .done { color: var(--green); text-shadow: var(--glow); }

/* Parts list — done vs pending clarity */
.parts-list-item { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #0e2a18; padding: 7px 0; font-size: 13px; gap: 8px; }
.parts-list-item.part-item-done { background: rgba(0,230,118,0.04); }
.parts-list-item.part-item-missing { opacity: 0.72; }
.part-done { color: var(--green); text-shadow: var(--glow); font-weight: bold; }
.part-pending { color: var(--green-dim); }
.part-missing-badge { font-size: 10px; letter-spacing: .1em; color: var(--green-dim); border: 1px solid var(--green-dim); padding: 1px 5px; opacity: 0.6; }

/* Quality selector — tiered visual design */
.quality-selector { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 12px; }
.q-btn {
  flex: 1; min-width: 110px; min-height: 52px;
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  gap: 2px; padding: 8px 10px;
  border: 1px solid var(--green-dim); background: var(--bg);
  transition: all 0.15s;
}
.q-btn:hover:not(:disabled) { border-color: var(--green); }
.q-btn-label { font-size: 13px; letter-spacing: 1px; font-family: var(--font); }
.q-btn-sub { font-size: 10px; color: var(--green-dim); letter-spacing: .05em; }
/* Tier colours */
.q-btn[data-qid="proto"]    { border-color: #1a5c34; }
.q-btn[data-qid="standard"] { border-color: #2a6040; }
.q-btn[data-qid="advanced"] { border-color: #3d5a28; }
.q-btn[data-qid="elite"]    { border-color: var(--amber-dim); }
/* Selected state — strong highlight */
.q-btn.selected { background: rgba(0,230,118,0.07); border-width: 2px; }
.q-btn[data-qid="proto"].selected    { border-color: var(--green-mid); color: var(--green-mid); }
.q-btn[data-qid="standard"].selected { border-color: var(--green); color: var(--green); box-shadow: 0 0 8px rgba(0,230,118,0.3); }
.q-btn[data-qid="advanced"].selected { border-color: #80ff60; color: #80ff60; box-shadow: 0 0 10px rgba(128,255,96,0.3); }
.q-btn[data-qid="elite"].selected    { border-color: var(--amber); color: var(--amber); box-shadow: 0 0 10px var(--amber-glow); background: rgba(255,171,0,0.07); }
.q-btn-label.q-lbl-proto    { color: inherit; }
.q-btn-label.q-lbl-standard { color: inherit; }
.q-btn-label.q-lbl-advanced { color: inherit; }
.q-btn-label.q-lbl-elite    { color: var(--amber); }

/* Assembly slot cards */
.slot-card {
  border: var(--border); background: var(--panel-bg);
  padding: 12px 14px; margin-bottom: 10px;
  min-height: 88px;
  transition: border-color 0.2s, box-shadow 0.2s;
}
.slot-card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; }
.slot-title { font-size: 13px; color: var(--green); letter-spacing: 1px; }

/* Status badge replacing plain text */
.slot-state {
  font-size: 10px; letter-spacing: .12em; padding: 2px 7px;
  border: 1px solid; border-radius: 0;
}
.slot-state.idle  { color: var(--green-dim); border-color: var(--green-dim); background: rgba(26,92,52,0.2); }
.slot-state.busy  { color: var(--amber);     border-color: var(--amber-dim); background: rgba(255,171,0,0.08); }
.slot-state.ready { color: var(--green);     border-color: var(--green);     background: rgba(0,230,118,0.1); text-shadow: var(--glow); }

/* Ready slot — glowing pulse to draw attention */
.slot-card.slot-ready {
  border-color: var(--green);
  box-shadow: 0 0 12px rgba(0,230,118,0.18);
  animation: pulse-slot-ready 2.5s ease-in-out infinite;
}
@keyframes pulse-slot-ready {
  0%,100% { box-shadow: 0 0 6px rgba(0,230,118,0.15); border-color: var(--green); }
  50%     { box-shadow: 0 0 18px rgba(0,230,118,0.35); border-color: var(--green); }
}
/* Busy slot — subtle amber tint */
.slot-card.slot-busy { border-color: var(--amber); }

.science-box { border: var(--border); background: var(--bg); padding: 10px 14px; font-size: 12px; color: var(--green-mid); margin-top: 10px; line-height: 1.7; }
.science-box .val { color: var(--green); }
.science-box .ms-val { color: var(--amber); }

/* 조립 스테이지 진행 ASCII 표시 */
#asm-stage-progress { font-size: 10px; line-height: 1.4; white-space: pre; padding: 4px 0; }
.ascii-prog-title { color: var(--green-dim); font-size: 10px; letter-spacing: .1em; }
.ascii-prog-bar-done { color: var(--green); text-shadow: var(--glow); }
.ascii-prog-bar-empty { color: var(--green-dim); }
.ascii-prog-pct { color: var(--amber); }
.ascii-stage-label-done { color: var(--green-mid); }
.ascii-stage-done { color: var(--green); text-shadow: var(--glow); }
.ascii-stage-label-active { color: var(--amber); }
.ascii-stage-active { color: var(--amber); text-shadow: 0 0 6px #ffab0060; }
.ascii-stage-label-locked { color: var(--green-dim); opacity: 0.4; }
.ascii-stage-locked { color: var(--green-dim); opacity: 0.4; }

/* BOM 테이블 */
.bom-table { width: 100%; border-collapse: collapse; font-size: 10px; }
.bom-table th { text-align: left; color: var(--green-dim); font-size: 10px; letter-spacing: .1em; text-transform: uppercase; padding: 4px 4px; border-bottom: 1px solid var(--green-dim); }
.bom-table td { padding: 4px 4px; border-bottom: 1px solid var(--green-deep); color: var(--green-mid); }
.bom-table tr:hover { background: rgba(0,230,118,0.03); }
.bom-table .status-ok { color: var(--green); text-shadow: var(--glow); }
.bom-table .status-in-progress { color: var(--amber); }
.bom-table .status-missing { color: var(--red); }
.bom-sub td:first-child { padding-left: 12px; }

/* ===========================
   LAUNCH TAB — V7D 3-COLUMN
   =========================== */
/* pane-launch 활성화 시 flex 3컬럼 */
#pane-launch.active { display: flex; height: 100%; padding: 0; overflow: hidden; }

/* 컬럼 공통 */
.lc-col { overflow-y: auto; overflow-x: hidden; flex-shrink: 0; }
.lc-col::-webkit-scrollbar { width: 3px; }
.lc-col::-webkit-scrollbar-thumb { background: var(--green-dim); }
.lc-col-left   { flex: 0 0 28%; max-width: 28%; border-right: 1px solid var(--green-dim); background: var(--panel-bg); }
.lc-col-center { flex: 0 0 44%; max-width: 44%; background: var(--bg); display: flex; flex-direction: column; overflow: hidden; }
.lc-col-right  { flex: 0 0 28%; max-width: 28%; border-left: 1px solid var(--green-dim); background: var(--panel-bg); }

/* LC 패널 (v7d 스타일) */
.lc-panel { padding: 8px 10px; border-bottom: 1px solid var(--green-dim); }
.lc-pnl-title { color: var(--green-dim); font-size: 10px; letter-spacing: .15em; text-transform: uppercase; margin-bottom: 5px; border-bottom: 1px solid var(--green-dim); padding-bottom: 3px; }
.lc-pnl-title.green { color: var(--green); text-shadow: var(--glow); border-bottom-color: var(--green-mid); }
.lc-pnl-title.amber { color: var(--amber); border-bottom-color: #5a3c00; }
.lc-pnl-title.cyan { color: #00cfff; border-bottom-color: #004466; }

/* 온보딩 퀘스트 패널 */
.qs-section-hd { color: var(--green-dim); font-size: 10px; letter-spacing: .18em; text-transform: uppercase; padding: 6px 0 3px; border-bottom: 1px solid var(--green-deep); margin-bottom: 4px; }
.qs-sub-hd { margin-top: 8px; border-top: 1px solid var(--green-dim); padding-top: 6px; }
.qs-cnt { color: var(--amber); margin-left: 6px; }
/* Main mission row */
.lc-quest-main { margin-bottom: 0; }
.lc-quest-main-row { display: flex; align-items: flex-start; gap: 6px; padding: 4px 0; }
.qs-main-text { flex: 1; color: var(--amber); font-size: 10px; line-height: 1.5; }
/* Complete state */
.lc-quest-main-done { padding: 4px 0; }
.lc-quest-main-done .lc-quest-main-title { color: var(--green); font-size: 10px; letter-spacing: .1em; text-shadow: var(--glow); margin-bottom: 3px; }
.lc-quest-main-done .lc-quest-main-desc  { color: var(--green-dim); font-size: 10px; line-height: 1.5; }
/* Sub missions */
.lc-quest-subs { display: flex; flex-direction: column; }
.lc-quest-sub  { display: flex; align-items: center; gap: 5px; font-size: 10px; padding: 3px 0; border-bottom: 1px solid var(--green-deep); }
.lc-quest-sub:last-child { border-bottom: none; }
/* Bracket icons (ASCII style, matches building icons) */
.qs-icon-bracket { font-size: 10px; flex-shrink: 0; min-width: 38px; color: var(--green-dim); font-family: 'Courier New', Consolas, monospace; letter-spacing: 0; opacity: 0.65; }
.qs-icon-bracket.done { color: var(--green); text-shadow: var(--glow); opacity: 1; }
.qs-text { flex: 1; color: var(--text-muted); font-size: 10px; }
.qs-text.done { color: var(--green-dim); text-decoration: line-through; opacity: 0.7; }
.qs-chk { font-size: 12px; flex-shrink: 0; min-width: 14px; text-align: right; }
.qs-chk.done { color: var(--green); text-shadow: var(--glow); }
.qs-chk.todo { color: #334433; }
/* 완료된 서브미션 행 전체 dim */
.lc-quest-sub.sub-done { opacity: 0.55; border-bottom-color: #060f06; }
.qs-all-ready { color: var(--amber); font-size: 10px; margin-top: 6px; letter-spacing: .08em; border-top: 1px solid #5a3c00; padding-top: 4px; }
/* 진행 미니 바 */
.qs-progress-bar  { height: 2px; background: var(--green-dim); margin: 2px 0 4px; overflow: hidden; }
.qs-progress-fill { height: 100%; background: var(--green); box-shadow: var(--glow); transition: width 0.4s ease; }

/* GO/NO-GO 체크리스트 */
.chk-row { display: flex; align-items: center; justify-content: space-between; padding: 4px 0; border-bottom: 1px solid #0d2010; font-size: 11px; }
.chk-row:last-child { border-bottom: none; }
.chk-name  { color: #8aaa8a; flex: 1; }
.chk-badge { font-size: 10px; padding: 1px 6px; border: 1px solid var(--green-mid); color: var(--green); background: rgba(0,230,118,.07); text-shadow: var(--glow); white-space: nowrap; }
.chk-badge.nogo { border-color: var(--red); color: var(--red); background: rgba(255,23,68,.08); text-shadow: none; }
.chk-all-go { background: rgba(0,230,118,.07); border: 1px solid var(--green); padding: 5px 8px; text-align: center; color: var(--green); font-size: 11px; letter-spacing: .1em; text-shadow: var(--glow); margin-top: 6px; animation: pulse-green 2.5s ease-in-out infinite; }
.chk-no-go  { background: rgba(255,23,68,.04); border: 1px solid #3a0a10; padding: 5px 8px; text-align: center; color: #8a3a3a; font-size: 11px; letter-spacing: .1em; margin-top: 6px; }
@keyframes pulse-green { 0%,100% { box-shadow: 0 0 4px #00e67660; } 50% { box-shadow: 0 0 14px #00e676bb, 0 0 28px #00e67640; } }

/* 데이터 행 */
.lc-drow     { display: flex; justify-content: space-between; align-items: center; font-size: 11px; padding: 2px 0; color: #8aaa8a; }
.lc-drow .v  { color: var(--green); text-shadow: var(--glow); }
.lc-drow .va { color: var(--amber); }

/* 중앙: pre-launch vs anim zone */
#lc-pre-launch { flex: 1; overflow-y: auto; display: flex; flex-direction: column; }
#lc-anim-zone  { flex: 1; overflow-y: auto; display: none; padding: 8px 12px; }
#lc-anim-zone.active { display: block; }

/* 로켓 디스플레이 */
.lc-rocket-disp { padding: 12px 0 8px; text-align: center; border-bottom: 1px solid var(--green-dim); flex-shrink: 0; }
.lc-rocket-art { display: inline-block; text-align: left; font-size: 11px; line-height: 1.35; white-space: pre; letter-spacing: 0; }

/* 조립 현황 슬롯 (LEFT 컬럼) */
.lc-asm-slot { padding: 6px; margin-bottom: 6px; border: 1px solid var(--green-dim); }
.lc-asm-slot-hd { font-size: 10px; color: var(--green-dim); letter-spacing: .08em; margin-bottom: 4px; }
.lc-asm-ready { border-color: var(--green); background: rgba(0,230,118,.04); }
.lc-asm-busy  { border-color: var(--amber); }
.lc-asm-prog-wrap { height: 3px; background: var(--green-deep); border-radius: 2px; overflow: hidden; margin-bottom: 2px; }
.lc-asm-prog-fill { height: 100%; background: var(--amber); border-radius: 2px; }
.lc-parts-status { border-top: 1px solid var(--green-dim); margin-top: 6px; padding-top: 6px; }

/* 발사 버튼 상태별 스타일 */
#lc-btn-launch.lc-btn-launch-standby { opacity: 0.45; border-style: dashed; animation: none; color: var(--green-dim); }
#lc-btn-launch.lc-btn-launch-go { opacity: 1; border-style: solid; animation: pulse-amber 3s ease-in-out infinite; color: var(--amber); }

/* 상태 바 */
.lc-sbar-wrap { padding: 8px 12px; border-bottom: 1px solid var(--green-dim); background: var(--panel-bg); flex-shrink: 0; }
.lc-sbar-row  { display: flex; align-items: center; gap: 6px; margin-bottom: 4px; }
.lc-sbar-lbl  { width: 60px; font-size: 10px; color: var(--green-mid); flex-shrink: 0; }
.lc-sbar-track { flex: 1; height: 8px; background: rgba(26,92,52,.35); border: 1px solid var(--green-dim); overflow: hidden; }
.lc-sbar-fill  { height: 100%; background: var(--green); box-shadow: 0 0 4px var(--green); transition: width .4s; }
.lc-sbar-fill.amber { background: var(--amber); box-shadow: 0 0 4px var(--amber); }
.lc-sbar-fill.red   { background: var(--red);   box-shadow: 0 0 4px var(--red); }
.lc-sbar-pct  { width: 34px; text-align: right; font-size: 10px; color: var(--green); flex-shrink: 0; }

/* 실패 확률 분석 */
.lc-fail-wrap { padding: 8px 12px; border-bottom: 1px solid var(--green-dim); flex-shrink: 0; }
.lc-fail-row  { display: flex; align-items: center; gap: 5px; margin-bottom: 4px; font-size: 10px; }
.lc-fail-name { width: 80px; color: #8aaa8a; flex-shrink: 0; }
.lc-fail-bar  { flex: 1; color: var(--red); font-size: 11px; letter-spacing: -1px; overflow: hidden; white-space: nowrap; }
.lc-fail-pct  { width: 30px; text-align: right; color: var(--amber); flex-shrink: 0; }
.lc-fail-lvl  { font-size: 10px; padding: 0 4px; border: 1px solid; flex-shrink: 0; }
.lc-fail-lvl.low  { border-color: var(--green-dim); color: var(--green-mid); }
.lc-fail-lvl.mid  { border-color: #5a3c00; color: var(--amber); }
.lc-fail-lvl.high { border-color: var(--red); color: var(--red); }

/* 발사 커밋 박스 */
#lc-commit-box { margin: 10px 12px 12px; border: 2px solid var(--amber); padding: 12px; background: #000d01; animation: pulse-amber 3s ease-in-out infinite; flex-shrink: 0; }
@keyframes pulse-amber { 0%,100% { box-shadow: 0 0 4px #ffab0060; border-color: var(--amber); } 50% { box-shadow: 0 0 20px #ffab00cc, 0 0 40px #ffab0040; border-color: #ffd050; } }
.lc-commit-hd    { color: var(--amber); font-size: 12px; letter-spacing: .15em; text-shadow: 0 0 8px #ffab0080; text-align: center; margin-bottom: 10px; }
.lc-commit-stats { display: flex; justify-content: space-around; margin-bottom: 12px; }
.lc-cs           { text-align: center; }
.lc-cs-val       { display: block; font-size: 20px; letter-spacing: .05em; margin-bottom: 2px; }
.lc-cs-val.green { color: var(--green); text-shadow: var(--glow-strong); }
.lc-cs-val.amber { color: var(--amber); text-shadow: 0 0 8px #ffab0080; }
.lc-cs-val.red   { color: var(--red);   text-shadow: 0 0 8px #ff174480; }
.lc-cs-label     { font-size: 10px; color: var(--green-dim); letter-spacing: .1em; }
#lc-btn-launch { display: block; width: 100%; padding: 10px 0; background: rgba(255,171,0,.08); border: 2px solid var(--amber); color: var(--amber); font-family: var(--font); font-size: 15px; letter-spacing: .2em; cursor: pointer; text-shadow: 0 0 8px #ffab0080; transition: background .2s; margin-bottom: 7px; }
#lc-btn-launch:hover:not(:disabled) { background: rgba(255,171,0,.2); }
#lc-btn-launch:disabled { opacity: .5; cursor: not-allowed; }
#lc-btn-abort  { display: block; width: 100%; padding: 6px 0; background: rgba(255,23,68,.07); border: 1px solid var(--red); color: var(--red); font-family: var(--font); font-size: 11px; letter-spacing: .15em; cursor: pointer; transition: background .2s; }
#lc-btn-abort:hover { background: rgba(255,23,68,.16); }

/* 이력 테이블 (우측) */
.lc-hist-table    { width: 100%; border-collapse: collapse; font-size: 10px; }
.lc-hist-table th { color: var(--green-dim); padding: 3px 5px; text-align: left; border-bottom: 1px solid var(--green-dim); }
.lc-hist-table td { padding: 4px 5px; border-bottom: 1px solid #0d1a0d; color: #8aaa8a; vertical-align: top; }

/* 통계 행 (우측) */
.lc-stat-row      { display: flex; justify-content: space-between; padding: 2px 0; font-size: 10px; color: #8aaa8a; }
.lc-stat-row .sv  { color: var(--green); }
.lc-stat-row .sva { color: var(--amber); }

/* 기존 animation 클래스 유지 */
.telemetry-wrap { border: var(--border); background: var(--bg); padding: 12px 14px; font-size: 13px; min-height: 120px; }
.telem-line { display: flex; align-items: center; gap: 8px; padding: 4px 0; border-bottom: 1px solid var(--green-deep); color: var(--green-mid); }
.telem-time  { color: var(--green-mid); min-width: 55px; font-size: 12px; }
.telem-event { min-width: 140px; color: var(--green); text-transform: uppercase; font-size: 12px; }
.telem-bar   { flex: 1; height: 6px; border: 1px solid var(--green-dim); }
.telem-bar-fill { height: 100%; background: var(--green-mid); transition: width 0.5s; }
.telem-pct   { color: var(--green); font-size: 12px; min-width: 38px; text-align: right; }
.launch-anim-wrap { text-align: center; padding: 14px; min-height: 150px; position: relative; overflow: hidden; border: var(--border); background: var(--bg); }
.launch-rocket-ascii { font-size: 12px; white-space: pre; color: var(--green); display: inline-block; }
.launch-rocket-ascii.launching { animation: rocket-launch 3s ease-in forwards; }
@keyframes rocket-launch { 0% { transform: translateY(0); } 100% { transform: translateY(-400px); } }
.exhaust-anim { font-size: 12px; white-space: pre; color: var(--amber); text-shadow: 0 0 6px var(--amber); display: inline-block; animation: exhaust-flicker 0.15s step-start infinite; }
@keyframes exhaust-flicker { 0%,100% { opacity: 1; } 50% { opacity: 0.4; } }
.launch-result { display: none; border: 1px solid var(--amber); background: rgba(255,171,0,0.05); padding: 14px; font-size: 13px; color: var(--amber); margin-top: 12px; }
.launch-result.show { display: block; }
.launch-result-title { font-size: 16px; letter-spacing: 3px; text-transform: uppercase; text-shadow: 0 0 12px var(--amber); margin-bottom: 8px; }
.launch-result-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; font-size: 12px; margin-bottom: 10px; }
.launch-result-stat-lbl { color: var(--green-mid); }
.launch-result-stat-val { color: var(--amber); }

/* ===========================
   MISSION TAB
   =========================== */
.phase-row { display: flex; align-items: center; gap: 12px; padding: 7px 0; border-bottom: 1px solid #0e2a18; font-size: 13px; }
.phase-name { min-width: 180px; color: var(--green-mid); text-transform: uppercase; font-size: 12px; }
.phase-bar-wrap { flex: 1; height: 8px; border: 1px solid var(--green-dim); background: var(--bg); }
.phase-bar-fill { height: 100%; background: var(--green-mid); transition: width 0.5s; }
.phase-bar-fill.done { background: var(--green); }
.phase-status { min-width: 80px; font-size: 12px; text-align: right; color: var(--green-mid); }
.phase-status.done { color: var(--green); }
.phase-status.locked { color: #0e2a18; }
.history-table { width: 100%; border-collapse: collapse; font-size: 12px; margin-top: 8px; }
.history-table th { background: #021508; color: var(--green-mid); text-align: left; padding: 6px 10px; border: var(--border); letter-spacing: 1px; font-weight: normal; text-transform: uppercase; }
.history-table td { padding: 5px 10px; border: 1px solid #0e2a18; color: var(--green); }
.history-table tr:hover td { background: rgba(0,230,118,0.04); }
.prestige-panel { border: 1px solid var(--amber); background: rgba(255,171,0,0.04); padding: 14px; margin-top: 12px; }
.prestige-stat { font-size: 13px; color: var(--amber); margin-bottom: 8px; line-height: 1.7; }
/* ── Moonstone upgrade shop ── */
.ms-shop { border: 1px solid #2a3a00; background: rgba(0,230,118,0.03); padding: 14px; margin: 12px 0; }
.ms-shop-hd { font-size: 11px; letter-spacing: 2px; color: var(--amber); margin-bottom: 12px; display: flex; align-items: center; gap: 12px; }
.ms-balance { color: var(--amber); font-size: 14px; font-weight: bold; }
.ms-shop-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(148px, 1fr)); gap: 8px; }
.ms-card { border: 1px solid #1a3820; background: #030e05; padding: 10px; display: flex; flex-direction: column; gap: 4px; transition: border-color 0.15s; }
.ms-card.buyable { border-color: var(--amber); }
.ms-card.maxed { border-color: var(--green-mid); opacity: 0.6; }
.ms-card-icon { font-size: 18px; line-height: 1; }
.ms-card-name { font-size: 11px; color: var(--white); letter-spacing: 1px; font-weight: bold; }
.ms-card-desc { font-size: 10px; color: var(--green-mid); line-height: 1.5; flex: 1; }
.ms-card-footer { display: flex; align-items: center; justify-content: space-between; margin-top: 4px; }
.ms-card-owned { font-size: 10px; color: var(--green-dim); }
.ms-card-maxed { font-size: 10px; color: var(--green-mid); letter-spacing: 1px; }
.ms-card-btn { font-family: inherit; font-size: 11px; border: 1px solid var(--amber); background: rgba(255,171,0,0.08); color: var(--amber); padding: 3px 8px; cursor: pointer; letter-spacing: 1px; transition: background 0.15s; }
.ms-card-btn:hover:not(.disabled) { background: rgba(255,171,0,0.2); }
.ms-card-btn.disabled { border-color: #333; color: #555; cursor: not-allowed; }

/* ── Mission Sub-tabs ── */
#mission-sub-tabs { display: flex; gap: 0; border-bottom: 1px solid var(--green-dim); padding: 0 10px; background: var(--panel-bg); flex-shrink: 0; }
.msn-sub-tab { background: none; border: none; border-bottom: 2px solid transparent; color: var(--green-dim); font-family: var(--font); font-size: 11px; letter-spacing: .1em; padding: 8px 14px; cursor: pointer; text-transform: uppercase; transition: all 0.15s; }
.msn-sub-tab:hover { color: var(--green); }
.msn-sub-tab.active { color: var(--green); border-bottom-color: var(--green); text-shadow: var(--glow); }
.msn-sub-screen { display: none; overflow-y: auto; flex: 1; padding: 10px 12px; }
.msn-sub-screen.active { display: block; }
/* mission tab overrides to flex column */
#pane-mission { flex-direction: column; }
#pane-mission.active { display: flex; flex-direction: column; height: 100%; overflow: hidden; animation: tab-enter 0.18s ease-out; }

/* ── 마일스톤 리스트 ── */
.msn-milestone-row { display: flex; align-items: center; gap: 10px; padding: 6px 0; border-bottom: 1px solid #0e2a18; font-size: 12px; }
.msn-milestone-icon { font-size: 14px; min-width: 30px; text-align: center; }
.msn-milestone-name { flex: 1; color: var(--green-mid); }
.msn-milestone-desc { flex: 2; color: var(--green-dim); font-size: 11px; }
.msn-milestone-status { min-width: 60px; text-align: right; font-size: 11px; }
.msn-milestone-status.done { color: var(--green); text-shadow: var(--glow); }
.msn-milestone-status.pending { color: var(--green-dim); }

/* ── P4-1: Phase Interactive Timeline ── */
.ptl-nodes { display: flex; align-items: center; justify-content: center; gap: 0; padding: 16px 8px 12px; }
.ptl-node { display: flex; flex-direction: column; align-items: center; cursor: pointer; position: relative; transition: all 0.15s; }
.ptl-node:hover:not(.locked) { transform: translateY(-2px); }
.ptl-dot { width: 36px; height: 36px; border-radius: 50%; border: 2px solid var(--green-dim); background: var(--panel-bg); display: flex; align-items: center; justify-content: center; font-size: 13px; color: var(--green-dim); transition: all 0.15s; }
.ptl-node.done .ptl-dot { border-color: var(--green); color: var(--green); background: #0a2a0f; text-shadow: var(--glow); }
.ptl-node.current .ptl-dot { border-color: var(--amber); color: var(--amber); background: #1a1200; text-shadow: var(--amber-glow); animation: ptl-pulse 2s ease-in-out infinite; }
.ptl-node.locked .ptl-dot { border-color: #1a2a1a; color: #1a2a1a; cursor: default; }
.ptl-node.selected .ptl-dot { box-shadow: 0 0 10px var(--green), 0 0 20px var(--green); border-color: var(--green); }
.ptl-label { font-size: 10px; color: var(--green-dim); margin-top: 4px; letter-spacing: 0.1em; }
.ptl-node.done .ptl-label { color: var(--green-mid); }
.ptl-node.current .ptl-label { color: var(--amber); }
.ptl-line { width: 40px; height: 2px; background: var(--green-dim); margin: 0 2px; margin-bottom: 20px; }
.ptl-line.done { background: var(--green); box-shadow: var(--glow); }
@keyframes ptl-pulse { 0%,100% { box-shadow: 0 0 4px var(--amber); } 50% { box-shadow: 0 0 12px var(--amber), 0 0 20px #ffab0040; } }

.ptl-detail { padding: 12px 0; }
.ptl-detail-hd { font-size: 15px; color: var(--green); letter-spacing: 2px; text-shadow: var(--glow); margin-bottom: 4px; }
.ptl-subtitle { font-size: 11px; color: var(--amber); letter-spacing: 3px; text-transform: uppercase; margin-bottom: 6px; }
.ptl-desc { font-size: 12px; color: var(--green-mid); margin-bottom: 6px; line-height: 1.5; }
.ptl-flavor { font-size: 11px; color: var(--amber-dim); font-style: italic; margin-bottom: 10px; }
.ptl-ascii { font-size: 11px; color: var(--green-mid); background: #010a02; border: 1px solid var(--green-dim); padding: 10px; margin: 8px 0; white-space: pre; overflow-x: auto; line-height: 1.3; }
.ptl-target { font-size: 12px; color: var(--green-mid); margin: 8px 0; }
.ptl-target-label { color: var(--amber); font-weight: bold; }
.ptl-progress { display: flex; align-items: center; gap: 10px; margin-top: 8px; }
.ptl-prog-bar-wrap { flex: 1; height: 8px; background: var(--building-bg-darker); border: 1px solid var(--green-dim); border-radius: 2px; }
.ptl-prog-fill { height: 100%; background: var(--green-dim); transition: width 0.3s; }
.ptl-prog-fill.done { background: var(--green); box-shadow: var(--glow); }
.ptl-prog-status { font-size: 12px; color: var(--green-mid); min-width: 50px; text-align: right; }

/* ── P4-2: Achievement System ── */
.ach-summary { font-size: 13px; color: var(--green-mid); margin-bottom: 10px; letter-spacing: 1px; }
.ach-cat-hd { font-size: 11px; color: var(--amber); letter-spacing: 2px; text-transform: uppercase; margin: 12px 0 6px; border-bottom: 1px solid #1a2a1a; padding-bottom: 4px; }
.ach-grid { display: flex; flex-direction: column; gap: 4px; }
.ach-card { display: flex; align-items: center; gap: 10px; padding: 8px 10px; border: 1px solid #0e2a18; transition: all 0.15s; }
.ach-card.earned { border-color: var(--green-dim); background: rgba(0, 230, 118, 0.03); }
.ach-card.locked { border-color: #0a1a0e; opacity: 0.6; }
.ach-icon { font-size: 16px; min-width: 36px; text-align: center; }
.ach-card.earned .ach-icon { color: var(--green); text-shadow: var(--glow); }
.ach-card.locked .ach-icon { color: var(--green-dim); }
.ach-info { flex: 1; }
.ach-name { font-size: 12px; color: var(--green); }
.ach-card.locked .ach-name { color: var(--green-dim); }
.ach-desc { font-size: 10px; color: var(--green-mid); margin-top: 2px; }
.ach-card.locked .ach-desc { color: var(--locked); }
.ach-reward { font-size: 10px; color: var(--amber-dim); margin-top: 2px; }
.ach-card.earned .ach-reward { color: var(--amber); }
.ach-status { font-size: 16px; min-width: 24px; text-align: center; }
.ach-card.earned .ach-status { color: var(--green); text-shadow: var(--glow); }
.ach-card.locked .ach-status { color: #1a2a1a; }

/* ── P4-3: Prestige Star Tree ── */
.pst-header { margin-bottom: 12px; }
.pst-title { font-size: 14px; color: var(--amber); letter-spacing: 3px; text-shadow: var(--amber-glow); }
.pst-summary { font-size: 11px; color: var(--green-mid); margin-top: 4px; }
.pst-tier-label { font-size: 11px; color: var(--amber-dim); letter-spacing: 2px; margin: 12px 0 6px; border-bottom: 1px solid #1a2a1a; padding-bottom: 4px; }
.pst-tier-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 8px; }
.pst-card { border: 1px solid #0e2a18; padding: 10px; transition: all 0.15s; }
.pst-card.owned { border-color: var(--amber-dim); background: rgba(255, 171, 0, 0.04); }
.pst-card.locked { border-color: #0a1a0e; opacity: 0.5; }
.pst-card.available { border-color: var(--green-dim); }
.pst-card.available:hover { border-color: var(--green); background: rgba(0, 230, 118, 0.04); }
.pst-star { font-size: 20px; color: var(--green-dim); margin-bottom: 4px; }
.pst-card.owned .pst-star { color: var(--amber); text-shadow: var(--amber-glow); }
.pst-card.available .pst-star { color: var(--green); }
.pst-node-name { font-size: 12px; color: var(--green); margin-bottom: 4px; }
.pst-card.locked .pst-node-name { color: var(--green-dim); }
.pst-card.owned .pst-node-name { color: var(--amber); }
.pst-node-desc { font-size: 10px; color: var(--green-mid); line-height: 1.4; margin-bottom: 6px; }
.pst-card.locked .pst-node-desc { color: var(--locked); }
.pst-node-footer { display: flex; align-items: center; justify-content: space-between; }
.pst-cost { font-size: 11px; color: var(--amber-dim); }
.pst-card.owned .pst-cost { color: var(--green-mid); }
.pst-buy-btn { background: none; border: 1px solid var(--green-dim); color: var(--green); font-family: var(--font); font-size: 10px; padding: 3px 10px; cursor: pointer; transition: all 0.15s; }
.pst-buy-btn:hover:not(.disabled) { border-color: var(--green); text-shadow: var(--glow); }
.pst-buy-btn.disabled { color: var(--green-dim); border-color: #0a1a0e; cursor: default; }

.pst-reset-section { margin-top: 16px; border-top: 1px solid var(--green-dim); padding-top: 12px; }
.pst-reset-hd { font-size: 12px; color: var(--amber); letter-spacing: 2px; margin-bottom: 8px; }
.pst-reset-info { font-size: 12px; color: var(--green-mid); margin-bottom: 8px; line-height: 1.8; }
.pst-reset-warn { font-size: 10px; color: var(--amber-dim); margin-bottom: 10px; line-height: 1.5; }
.pst-hist-hd { font-size: 12px; color: var(--green-mid); letter-spacing: 1px; margin-top: 16px; margin-bottom: 6px; }

/* ── P4-4: World Scene Enhanced Hover for Production Tab ── */
body.tab-production .world-bld { cursor: pointer; transition: transform 0.1s, filter 0.1s; }
body.tab-production .world-bld:hover { transform: scale(1.05); filter: brightness(1.3); }

/* ── P4-6: ERA Badge + Subtitle ── */
.tb-era { display: inline-block; background: var(--amber); color: var(--bg); font-size: 10px; font-weight: bold; letter-spacing: 2px; padding: 2px 8px; text-transform: uppercase; }
.tb-subtitle { color: var(--green-mid); font-size: 12px; letter-spacing: 1px; }

/* ===========================
   LAUNCH OVERLAY
   =========================== */
#launch-overlay { display: none; position: fixed; inset: 0; background: rgba(1,8,0,0.97); z-index: 7000; align-items: center; justify-content: center; flex-direction: column; text-align: center; padding: 24px; }
#launch-overlay.show { display: flex; }
.lo-title { font-size: 28px; letter-spacing: 8px; text-transform: uppercase; color: var(--amber); text-shadow: 0 0 20px var(--amber); margin-bottom: 14px; }
.lo-rocket { font-size: 12px; white-space: pre; color: var(--amber); text-shadow: 0 0 6px #ffab0080; margin-bottom: 14px; animation: rocket-launch 4s ease-in forwards; }
.lo-stats { font-size: 15px; color: var(--green); margin-bottom: 18px; line-height: 2.2; text-shadow: var(--glow); }
.lo-ms { font-size: 20px; color: var(--amber); letter-spacing: 3px; margin-bottom: 24px; }
.lo-btns { display: flex; gap: 14px; justify-content: center; flex-wrap: wrap; }

/* ===========================
   TAB FADE-IN ANIMATION
   =========================== */
@keyframes tab-enter {
  from { opacity: 0; transform: translateY(8px); }
  to   { opacity: 1; transform: translateY(0); }
}
.tab-pane.active {
  display: block;
  animation: tab-enter 0.18s ease-out;
}
/* launch tab overrides to flex */
#pane-launch.active { display: flex; animation: tab-enter 0.18s ease-out; }
/* assembly tab overrides to flex (3-column) */
#pane-assembly.active { display: flex; height: 100%; padding: 0; overflow: hidden; animation: tab-enter 0.18s ease-out; }

/* ===========================
   BUILDING PRODUCTION PULSE
   =========================== */
@keyframes bld-production-pulse {
  0%, 100% {
    text-shadow: 0 0 8px rgba(0,230,118,0.55);
    opacity: 1;
  }
  50% {
    text-shadow: 0 0 18px rgba(0,230,118,0.9), 0 0 36px rgba(0,230,118,0.3);
    opacity: 0.92;
  }
}
.world-bld.wb-state-active { animation: bld-production-pulse 2.4s ease-in-out infinite; }
.world-bld.wb-state-active:hover { animation: none; text-shadow: 0 0 16px #00e676cc; }

/* ===========================
   RESEARCH TREE — RELATION LINE ENHANCEMENT
   =========================== */
/* Tier arrow between columns — stronger connector look */
.rsh-tier-arrow {
  display: flex; align-items: flex-start; justify-content: center;
  width: 26px; padding-top: 34px; color: var(--green-mid);
  font-size: 14px; flex-shrink: 0; position: relative;
}
.rsh-tier-arrow::before {
  content: '';
  position: absolute; top: 0; bottom: 0; left: 50%;
  width: 1px;
  background: linear-gradient(to bottom, transparent 0%, var(--green-dim) 30%, var(--green-dim) 70%, transparent 100%);
  opacity: 0.45;
}
/* Card available state — subtle left border accent */
.rsh-card2.available { border-left: 2px solid var(--green-mid); }
.rsh-card2.done      { border-left: 2px solid #1a4a2a; }

/* ===========================
   AUTOMATION TAB
   =========================== */
#pane-automation.active { padding: 10px 14px; }
.at-header {
  display: flex; justify-content: space-between; align-items: center;
  border-bottom: 1px solid var(--green-dim); padding-bottom: 8px; margin-bottom: 12px;
}
.at-title { font-size: 13px; letter-spacing: 2px; color: var(--green); text-shadow: var(--glow); }
.at-ms-balance { font-size: 14px; color: var(--amber); text-shadow: var(--amber-glow); }
.at-tier-hd {
  font-size: 10px; letter-spacing: 3px; text-transform: uppercase;
  color: var(--green-mid); padding: 6px 0 4px;
  border-bottom: 1px solid var(--green-dim); margin-bottom: 8px;
}
.at-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 8px; margin-bottom: 14px;
}
.at-card {
  border: 1px solid var(--locked); background: rgba(1,8,0,0.85);
  padding: 10px; display: flex; flex-direction: column; gap: 5px;
  transition: border-color 0.15s, background 0.15s;
}
.at-card-locked  { border-color: var(--locked); opacity: 0.55; }
.at-card-buyable { border-color: var(--amber-dim); }
.at-card-buyable:hover { border-color: var(--amber); background: rgba(255,171,0,0.04); }
.at-card-on  { border-color: var(--green-mid); background: rgba(0,230,118,0.04); }
.at-card-off { border-color: #1a3820; opacity: 0.75; }
.at-card-top { display: flex; align-items: center; gap: 6px; }
.at-icon { font-size: 13px; color: var(--green-mid); min-width: 36px; font-family: monospace; }
.at-name { flex: 1; color: var(--white); font-size: 11px; letter-spacing: 1px; }
.at-cost { color: var(--amber); font-size: 11px; white-space: nowrap; }
.at-desc { font-size: 10px; color: var(--text-muted); line-height: 1.6; flex: 1; }
.at-req  { font-size: 10px; color: var(--locked); letter-spacing: 1px; }
.at-toggle {
  display: block; width: 100%; padding: 4px 8px;
  background: transparent; border: 1px solid; cursor: pointer;
  font-family: var(--font); font-size: 11px; letter-spacing: 1px;
  transition: background 0.12s; margin-top: 2px;
}
.at-toggle-on     { border-color: var(--green); color: var(--green); }
.at-toggle-on:hover { background: rgba(0,230,118,0.1); }
.at-toggle-off    { border-color: #2a4a2a; color: #2a4a2a; }
.at-toggle-off:hover { background: rgba(0,230,118,0.04); color: var(--green-dim); border-color: var(--green-dim); }
.at-toggle-buy    { border-color: var(--amber); color: var(--amber); }
.at-toggle-buy:hover { background: rgba(255,171,0,0.12); }
.at-toggle-poor   { border-color: #3a2800; color: #5a4000; cursor: not-allowed; }
.at-toggle-locked { border-color: var(--locked); color: var(--locked); cursor: not-allowed; }
.at-footer {
  font-size: 10px; color: var(--green-dim); letter-spacing: 2px;
  border-top: 1px solid var(--green-dim); padding-top: 8px; margin-top: 4px;
}

/* ===========================
   OFFLINE REPORT MODAL
   =========================== */
.ofr-backdrop {
  position: fixed; inset: 0; z-index: 9000;
  background: rgba(1,8,0,0.92);
  display: flex; align-items: center; justify-content: center;
}
.ofr-box {
  background: var(--panel-bg); border: 2px solid var(--green-dim);
  padding: 24px 28px; max-width: 480px; width: 92%;
  display: flex; flex-direction: column; gap: 6px;
  box-shadow: 0 0 30px rgba(0,230,118,0.10);
}
.ofr-hd   { font-size: 14px; letter-spacing: 4px; color: var(--green); text-shadow: var(--glow); border-bottom: 1px solid var(--green-dim); padding-bottom: 8px; margin-bottom: 4px; }
.ofr-time { font-size: 12px; color: var(--green-mid); margin-bottom: 6px; }
.ofr-section-hd { font-size: 10px; letter-spacing: 3px; color: var(--green-mid); text-transform: uppercase; margin: 8px 0 4px; border-bottom: 1px solid var(--green-deep); padding-bottom: 3px; }
.ofr-row  { display: flex; justify-content: space-between; align-items: center; font-size: 12px; padding: 3px 0; border-bottom: 1px solid var(--green-deep); }
.ofr-lbl  { color: var(--green-dim); }
.ofr-val  { color: var(--green); font-weight: bold; }
.ofr-launch-row { display: flex; align-items: center; gap: 6px; flex-wrap: wrap; font-size: 11px; padding: 3px 0; border-bottom: 1px solid var(--green-deep); }
.ofr-quality     { color: var(--white); min-width: 80px; }
.ofr-launch-stat { color: var(--green-dim); font-size: 10px; }
.ofr-total .ofr-lbl { color: var(--amber-dim); }
.ofr-total .ofr-val { color: var(--amber); }
.ofr-empty { font-size: 11px; color: var(--locked); padding: 4px 0; }
.ofr-confirm-btn {
  margin-top: 12px; display: block; width: 100%; padding: 9px 0;
  background: transparent; border: 1px solid var(--green-mid);
  color: var(--green); font-family: var(--font); font-size: 13px;
  letter-spacing: 3px; cursor: pointer; transition: all 0.15s;
}
.ofr-confirm-btn:hover { border-color: var(--green); text-shadow: var(--glow); background: rgba(0,230,118,0.05); }

/* ── Milestone Panel ── */
#milestone-panel { margin-top: 8px; padding-top: 6px; border-top: 1px solid var(--green-deep); }
.ml-hd { font-size: 10px; color: var(--green-dim); letter-spacing: 2px; margin-bottom: 4px; }
.ml-count { color: var(--green-mid); }
.ml-row { display: flex; align-items: flex-start; gap: 5px; padding: 3px 0; border-bottom: 1px solid var(--green-deep); opacity: 0.6; }
.ml-row.ml-done { opacity: 1; }
.ml-chk { font-size: 10px; color: var(--green-dim); min-width: 10px; padding-top: 1px; }
.ml-row.ml-done .ml-chk { color: var(--green); }
.ml-body { display: flex; flex-direction: column; gap: 1px; flex: 1; text-align: left; }
.ml-name { font-size: 10px; color: var(--white); }
.ml-row.ml-done .ml-name { color: var(--green); }
.ml-desc { font-size: 10px; color: var(--text-muted); }
.ml-reward { font-size: 10px; color: var(--amber-dim); }
.ml-reward.ml-reward-done { color: var(--green-dim); }

/* ── Mission Goal Panel ── */
#mission-goal { margin-top: 8px; padding-top: 6px; border-top: 1px solid var(--green-deep); }
.mg-rocket-wrap { text-align: center; margin-bottom: 5px; }
.mg-rocket-label { font-size: 10px; color: var(--green-dim); letter-spacing: 2px; }
.mg-rocket { font-size: 10px; color: var(--green); line-height: 1.3; text-shadow: var(--glow); display: inline-block; text-align: left; }
.mg-title { font-size: 10px; color: var(--amber); letter-spacing: 1px; margin-bottom: 4px; }
.mg-bar-row { display: flex; align-items: center; gap: 3px; font-size: 10px; margin-bottom: 2px; }
.mg-bar-lbl { color: var(--green-dim); min-width: 40px; }
.mg-bar-val { color: var(--green); font-size: 8px; flex: 1; }
.mg-bar-cnt { color: var(--green-mid); min-width: 28px; text-align: right; }
.mg-next { font-size: 10px; color: var(--text-muted); margin-top: 4px; line-height: 1.4; }

/* ── 미건설 건물 ghost 표시 ── */
.ghost-bld { opacity: 0.5; filter: grayscale(0.7); border: 1px dashed #1a4a2a !important; }
.ghost-bld .wb-name { color: #2a5a3a !important; font-size: 10px; }
.ghost-bld:hover { opacity: 0.7; border-color: var(--green-dim) !important; }

/* ── 활성 건물 강조 이펙트 ── */
.world-bld.active-bld {
  filter: brightness(1.4) !important;
  text-shadow: 0 0 8px var(--green), 0 0 16px rgba(0,230,118,0.4) !important;
  border-color: var(--green-mid) !important;
  transition: filter 0.3s, text-shadow 0.3s;
}
.world-bld.active-bld.has-workers {
  animation: bld-pulse 2s ease-in-out infinite alternate;
}
@keyframes bld-pulse {
  from { text-shadow: 0 0 6px var(--green), 0 0 12px rgba(0,230,118,0.3); }
  to   { text-shadow: 0 0 12px var(--green), 0 0 24px rgba(0,230,118,0.6), 0 0 40px rgba(0,230,118,0.2); }
}

/* ── 플로팅 숫자 이펙트 ── */
.float-num {
  position: fixed;
  pointer-events: none;
  font-family: var(--font);
  font-size: 14px;
  font-weight: bold;
  z-index: 9500;
  animation: float-up 1.4s ease-out forwards;
}
.float-num.money    { color: #ffeb3b; text-shadow: 0 0 8px #ffeb3b80; }
.float-num.metal    { color: #90caf9; text-shadow: 0 0 8px #90caf980; }
.float-num.fuel     { color: #a5d6a7; text-shadow: 0 0 8px #a5d6a780; }
.float-num.elec     { color: #ce93d8; text-shadow: 0 0 8px #ce93d880; }
.float-num.research { color: var(--amber); text-shadow: 0 0 8px rgba(255,171,0,0.5); }
.float-num.ms       { color: #80deea; text-shadow: 0 0 10px #80deea; }
@keyframes float-up {
  0%   { opacity: 1;   transform: translateY(0)    scale(1); }
  60%  { opacity: 0.8; transform: translateY(-40px) scale(1.1); }
  100% { opacity: 0;   transform: translateY(-80px) scale(0.8); }
}

/* ── ASCII 파티클 ── */
.ascii-particle {
  position: fixed;
  pointer-events: none;
  font-family: var(--font);
  font-size: 12px;
  color: var(--green);
  z-index: 9400;
  animation: particle-burst 0.8s ease-out forwards;
}
@keyframes particle-burst {
  0%   { opacity: 1; transform: translate(0,0) scale(1); }
  100% { opacity: 0; transform: translate(var(--dx),var(--dy)) scale(0.5); }
}

/* ── 건물 건설 플래시 ── */
@keyframes bld-build-flash {
  0%   { filter: brightness(3) saturate(2); }
  100% { filter: brightness(1) saturate(1); }
}
.bld-build-flash { animation: bld-build-flash 0.6s ease-out; }

/* ===========================
   [S3 U3-1] 조립 탭 3-column CSS (v7c 기준)
   =========================== */
.assembly-3col {
  display: flex;
  height: 100%;
  overflow: hidden;
}
.assembly-3col .asm-col-left {
  width: 30%;
  flex-shrink: 0;
  border-right: 1px solid var(--green-dim);
  background: var(--panel-bg);
  overflow-y: auto;
  overflow-x: hidden;
}
.assembly-3col .asm-col-center {
  width: 40%;
  flex-shrink: 0;
  border-right: 1px solid var(--green-dim);
  background: var(--bg);
  display: flex;
  flex-direction: column;
  overflow: hidden;
}
.assembly-3col .asm-col-right {
  width: 30%;
  flex-shrink: 0;
  background: var(--panel-bg);
  overflow-y: auto;
  overflow-x: hidden;
}
.assembly-3col .asm-col-left::-webkit-scrollbar,
.assembly-3col .asm-col-right::-webkit-scrollbar { width: 4px; background: var(--bg); }
.assembly-3col .asm-col-left::-webkit-scrollbar-thumb,
.assembly-3col .asm-col-right::-webkit-scrollbar-thumb { background: var(--green-dim); }

/* Column header (v7c) */
.asm-col-header {
  background: #011005;
  border-bottom: 2px solid var(--green-dim);
  padding: 4px 12px;
  font-size: 10px;
  letter-spacing: 3px;
  color: var(--green);
  text-shadow: var(--glow);
  flex-shrink: 0;
  display: flex;
  align-items: center;
  gap: 8px;
  text-transform: uppercase;
}
.asm-col-header::before { content: '//'; color: var(--green-mid); font-size: 12px; }

/* Section blocks inside columns */
.asm-section { padding: 8px 12px; border-bottom: var(--border); }
.asm-section:last-child { border-bottom: none; }
.asm-section-title {
  font-size: 10px; letter-spacing: 2px; color: var(--green-mid);
  margin-bottom: 6px; padding-bottom: 3px;
  border-bottom: 1px solid #0a2e14; text-transform: uppercase;
}

/* Rocket class selector cards (v7c) */
.class-card {
  padding: 5px 6px;
  border: 1px solid var(--green-dim);
  background: var(--bg);
  color: var(--green-mid);
  font-family: var(--font);
  font-size: 10px;
  letter-spacing: 1px;
  cursor: pointer;
  transition: all 0.15s;
  text-align: left;
  position: relative;
}
.class-card:hover:not(.locked) {
  border-color: var(--green);
  color: var(--green);
  background: #030f05;
}
.class-card.selected {
  border-color: var(--green);
  background: #011a08;
  color: var(--green);
  text-shadow: var(--glow);
  box-shadow: inset 0 0 8px #00e67620;
}
.class-card.locked {
  border-color: #0a2e14;
  color: #1a5c34;
  cursor: not-allowed;
  background: #010b03;
}
.class-card .lock-icon { float: right; font-size: 10px; color: #1a5c34; }
.class-card .radio {
  display: inline-block; width: 8px; height: 8px;
  border: 1px solid currentColor; border-radius: 50%;
  margin-right: 5px; vertical-align: middle; position: relative;
}
.class-card.selected .radio::after {
  content: '';
  position: absolute; inset: 2px;
  background: var(--green); border-radius: 50%;
  box-shadow: var(--glow);
}
.class-card-grid {
  display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-bottom: 4px;
}

/* ===========================
   [S3 U3-2] BOM 테이블 CSS + 호버 하이라이트 (v7c 기준)
   =========================== */
.bom-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 10px;
}
.bom-table th {
  text-align: left;
  color: var(--green-mid);
  font-size: 10px;
  letter-spacing: 1px;
  padding: 3px 4px;
  border-bottom: 1px solid var(--green-dim);
  white-space: nowrap;
}
.bom-table td {
  padding: 3px 4px;
  vertical-align: middle;
  border-bottom: 1px solid #0a2e14;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
/* Row hover — glow border highlight */
.bom-table tr:hover td {
  background: #011a08;
  cursor: pointer;
  box-shadow: inset 0 0 6px rgba(0,230,118,0.08);
}
.bom-table tr.bom-highlight td {
  background: #011a08;
  border-bottom-color: var(--green);
  box-shadow: 0 0 8px rgba(0,230,118,0.15);
}
/* Sub rows (indented) */
.bom-table tr.bom-sub td {
  color: var(--green-mid);
  font-size: 10px;
  padding-left: 12px;
}
.bom-table tr.bom-sub:hover td {
  background: #010e04;
}
/* Status icons */
.bom-status-ok { color: var(--green); text-shadow: var(--glow); }
.bom-status-ok::before { content: '\2713 '; /* checkmark */ }
.bom-status-progress { color: var(--amber); text-shadow: var(--amber-glow); animation: pulse-amber 2s ease-in-out infinite; }
.bom-status-pending { color: #1a5c34; }
.bom-status-missing { color: var(--red); }
.bom-status-missing::before { content: '\26A0 '; /* warning */ }

/* ===========================
   [S3 U3-3] 프로그레스 바 shimmer + leading edge 전 탭 적용
   (TA progress-shimmer.css 패치 기반)
   =========================== */
@keyframes progress-shimmer {
  0%   { background-position: -200% center; }
  100% { background-position:  200% center; }
}

/* Override base .prog-fill with shimmer */
.prog-fill {
  height: 100%;
  background: linear-gradient(90deg, #00994d, #00e676, #00994d);
  background-size: 200% 100%;
  animation: progress-shimmer 2.5s linear infinite;
  transition: width 0.3s;
  position: relative;
}

/* Leading edge: 2px white glow at fill tip */
.prog-fill::after {
  content: '';
  position: absolute;
  right: 0; top: 0; bottom: 0;
  width: 2px;
  background: white;
  box-shadow:
    0 0 4px rgba(255,255,255,0.9),
    0 0 8px var(--green);
  pointer-events: none;
}

/* Also apply to rocket build phase bars */
.rc-phase-bar-fill {
  background: linear-gradient(90deg, #00994d, #00e676, #00994d);
  background-size: 200% 100%;
  animation: progress-shimmer 2.5s linear infinite;
  position: relative;
}
.rc-phase-bar-fill::after {
  content: '';
  position: absolute;
  right: 0; top: 0; bottom: 0;
  width: 2px;
  background: white;
  box-shadow: 0 0 4px rgba(255,255,255,0.9), 0 0 8px var(--green);
  pointer-events: none;
}
.rc-phase-bar-fill.done {
  background: var(--green);
  box-shadow: 0 0 4px var(--green);
  animation: none;
}
.rc-phase-bar-fill.done::after { display: none; }

/* Resource bars shimmer */
.rl-bar-fill {
  background: linear-gradient(90deg, #005530, #00994d, #005530);
  background-size: 200% 100%;
  animation: progress-shimmer 3s linear infinite;
  position: relative;
}
.rl-bar-fill::after {
  content: '';
  position: absolute;
  right: 0; top: 0; bottom: 0;
  width: 1px;
  background: white;
  box-shadow: 0 0 3px rgba(255,255,255,0.7), 0 0 6px var(--green);
  pointer-events: none;
}

/* Staff panel bars shimmer */
.gfill {
  background: linear-gradient(90deg, #005530, #00e676, #005530);
  background-size: 200% 100%;
  animation: progress-shimmer 3s linear infinite;
  position: relative;
}
.gfill::after {
  content: '';
  position: absolute;
  right: 0; top: 0; bottom: 0;
  width: 1px;
  background: white;
  box-shadow: 0 0 3px rgba(255,255,255,0.7), 0 0 6px var(--green);
  pointer-events: none;
}
.gfill.a {
  background: linear-gradient(90deg, #8b6914, #ffc107, #8b6914);
  background-size: 200% 100%;
  animation: progress-shimmer 3s linear infinite;
}

/* Launch tab status bars shimmer */
.lc-sbar-fill {
  background: linear-gradient(90deg, #005530, #00e676, #005530);
  background-size: 200% 100%;
  animation: progress-shimmer 2.5s linear infinite;
  position: relative;
}
.lc-sbar-fill::after {
  content: '';
  position: absolute;
  right: 0; top: 0; bottom: 0;
  width: 2px;
  background: white;
  box-shadow: 0 0 4px rgba(255,255,255,0.9), 0 0 8px var(--green);
  pointer-events: none;
}
.lc-sbar-fill.amber {
  background: linear-gradient(90deg, #8b6914, #ffc107, #8b6914);
  background-size: 200% 100%;
  animation: progress-shimmer 2.5s linear infinite;
  box-shadow: 0 0 4px var(--amber);
}
.lc-sbar-fill.amber::after {
  background: #fff8e1;
  box-shadow: 0 0 4px rgba(255,248,225,0.9), 0 0 8px var(--amber);
}
.lc-sbar-fill.red {
  background: linear-gradient(90deg, #5c0a15, #ff1744, #5c0a15);
  background-size: 200% 100%;
  animation: progress-shimmer 2.5s linear infinite;
  box-shadow: 0 0 4px var(--red);
}

/* Quest progress bar shimmer */
.qs-progress-fill {
  background: linear-gradient(90deg, #005530, #00e676, #005530);
  background-size: 200% 100%;
  animation: progress-shimmer 3s linear infinite;
}

/* Risk tag with pulse */
.risk-tag {
  display: flex;
  align-items: center;
  gap: 5px;
  padding: 2px 8px;
  border: 1px solid #5c0a15;
  font-size: 10px;
  font-family: var(--font);
  color: var(--red);
  margin-bottom: 3px;
  animation: pulse-red 2.5s ease-in-out infinite;
}
.risk-tag::before { content: '\26A0'; font-size: 10px; }
@keyframes pulse-red {
  0%, 100% { color: var(--red); border-color: #5c0a15; text-shadow: 0 0 4px rgba(255,23,68,0.3); }
  50%      { color: #7a0020; border-color: #2a0510; text-shadow: none; }
}

/* ===========================
   [S3 U3-4] 임무 탭 서브탭 CSS + 페이즈 타임라인 노드 스타일 (v7e 기준)
   =========================== */
/* Sub-tab navigation bar */
.sub-tab-nav {
  display: flex;
  background: #010a02;
  border-bottom: var(--border);
  flex-shrink: 0;
  padding: 0 16px;
}
.sub-tab-btn {
  padding: 5px 16px;
  font-family: var(--font);
  font-size: 10px;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--green-dim);
  background: transparent;
  border: none;
  border-bottom: 2px solid transparent;
  cursor: pointer;
  transition: color 0.15s;
}
.sub-tab-btn:hover { color: var(--green-mid); }
.sub-tab-btn.active {
  color: var(--green);
  border-bottom-color: var(--green);
  text-shadow: var(--glow);
}

/* Phase timeline strip */
.phase-timeline {
  flex-shrink: 0;
  background: #010d03;
  border-bottom: 2px solid var(--green-dim);
  padding: 14px 24px 16px;
  position: relative;
  overflow: hidden;
}
.phase-timeline .zone-label {
  font-size: 10px;
  letter-spacing: 3px;
  color: var(--green-dim);
  margin-bottom: 10px;
}

/* Timeline row container */
.phase-timeline-row {
  display: flex;
  align-items: center;
  position: relative;
  height: 80px;
}

/* Phase connector lines between nodes */
.phase-connector {
  flex: 1;
  height: 2px;
  background: var(--green-dim);
  position: relative;
}
.phase-connector.complete {
  background: var(--green);
  box-shadow: 0 0 6px var(--green);
}
.phase-connector.partial {
  background: linear-gradient(to right, var(--green) 60%, var(--green-dim) 60%);
}
.phase-connector.locked {
  background: #0a1e0e;
}

/* Phase node wrapper */
.phase-node {
  display: flex;
  flex-direction: column;
  align-items: center;
  position: relative;
  cursor: pointer;
  gap: 0;
}

/* Phase dot — the main node circle */
.phase-dot {
  width: 36px;
  height: 36px;
  border: 2px solid var(--green-dim);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 13px;
  background: var(--bg);
  position: relative;
  z-index: 2;
  transition: transform 0.15s;
}
.phase-node:hover .phase-dot { transform: scale(1.1); }

/* Phase dot states */
.phase-dot.complete {
  border-color: var(--green);
  background: #010f05;
  box-shadow: var(--glow-strong);
  color: var(--green);
  text-shadow: var(--glow-strong);
}
@keyframes progress-pulse {
  0%, 100% { box-shadow: 0 0 4px var(--amber); }
  50%      { box-shadow: 0 0 12px var(--amber), 0 0 20px #ffab0050; }
}
.phase-dot.in-progress {
  border-color: var(--amber);
  background: #0a0500;
  box-shadow: 0 0 10px var(--amber), 0 0 20px #ffab0060;
  color: var(--amber);
  animation: progress-pulse 2s ease-in-out infinite;
}
.phase-dot.locked {
  border-color: #0a2010;
  background: #010800;
  color: #1a3a20;
}

/* Phase info below dot */
.phase-info {
  position: absolute;
  top: 44px; left: 50%;
  transform: translateX(-50%);
  text-align: center;
  white-space: nowrap;
  pointer-events: none;
}
.phase-info .phase-name-label {
  font-size: 10px; letter-spacing: 1.5px; display: block; margin-bottom: 2px;
}
.phase-info .phase-name-label.complete { color: var(--green); text-shadow: var(--glow); }
.phase-info .phase-name-label.in-progress { color: var(--amber); text-shadow: var(--amber-glow); }
.phase-info .phase-name-label.locked { color: #2a5c35; }

.phase-status-text { font-size: 10px; letter-spacing: 1px; display: block; }
.phase-status-text.complete { color: var(--green-mid); }
.phase-status-text.in-progress { color: var(--amber-dim); }
.phase-status-text.locked { color: #1a3a20; }

.phase-sub-text { font-size: 8px; letter-spacing: 0.5px; margin-top: 2px; display: block; }
.phase-sub-text.complete { color: #2a7a4a; }
.phase-sub-text.in-progress { color: var(--amber-dim); }
.phase-sub-text.locked { color: #0f2514; }

/* Mini progress bar under active phase dot */
.phase-mini-progress {
  position: absolute;
  bottom: -6px; left: 50%;
  transform: translateX(-50%);
  width: 60px;
}
.phase-mini-bar {
  width: 100%; height: 3px;
  background: var(--building-roof);
  position: relative;
}
.phase-mini-fill {
  height: 100%;
  background: var(--amber);
  box-shadow: 0 0 4px var(--amber);
}

/* ===========================
   [S3 U3-5] 앰버 프로그레스 바 변형 CSS
   =========================== */
/* Amber variant for .prog-fill (heat/thermal management) */
.prog-fill.amber,
.prog-fill.progress-amber,
.progress-amber .prog-fill {
  background: linear-gradient(90deg, #8b6914, #ffc107, #8b6914);
  background-size: 200% 100%;
  animation: progress-shimmer 2.5s linear infinite;
  box-shadow: 0 0 4px rgba(255,171,0,0.5);
}
.prog-fill.amber::after,
.prog-fill.progress-amber::after,
.progress-amber .prog-fill::after {
  background: #fff8e1;
  box-shadow:
    0 0 4px rgba(255,248,225,0.9),
    0 0 8px var(--amber);
}

/* Standalone .progress-amber class for wrapping containers */
.progress-amber .prog-wrap { border-color: var(--amber-dim); }

/* Amber resource bar variant */
.rl-bar-fill.amber {
  background: linear-gradient(90deg, #8b6914, #ffc107, #8b6914);
  background-size: 200% 100%;
  animation: progress-shimmer 3s linear infinite;
}
.rl-bar-fill.amber::after {
  background: #fff8e1;
  box-shadow: 0 0 3px rgba(255,248,225,0.7), 0 0 6px var(--amber);
}

/* ===========================
   [S4 U4-1] 페이즈 타임라인 CSS 보강 (v7e 기준)
   =========================== */
/* Alternate class aliases — programmer may use .completed / .current */
.phase-dot.completed {
  border-color: var(--green);
  background: #010f05;
  box-shadow: var(--glow-strong);
  color: var(--green);
  text-shadow: var(--glow-strong);
}
.phase-dot.current {
  border-color: var(--amber);
  background: #0a0500;
  box-shadow: 0 0 10px var(--amber), 0 0 20px #ffab0060;
  color: var(--amber);
  animation: progress-pulse 2s ease-in-out infinite;
}
.phase-connector.completed {
  background: var(--green);
  box-shadow: 0 0 6px var(--green);
}
/* Dashed connector for locked phases */
.phase-connector.locked {
  background: none;
  border-top: 2px dashed #0a2010;
  height: 0;
}
/* Phase info expandable panel — ASCII scene display below timeline */
.phase-info-expand {
  background: #010a02;
  border: 1px solid var(--green-dim);
  border-top: none;
  padding: 0 16px;
  overflow: hidden;
  max-height: 0;
  opacity: 0;
  transition: max-height 0.35s ease, opacity 0.25s ease, padding 0.35s ease;
}
.phase-info-expand.open {
  max-height: 400px;
  opacity: 1;
  padding: 12px 16px;
}
.phase-info-expand .ascii-scene {
  font-size: 11px;
  line-height: 1.3;
  color: var(--green);
  text-shadow: 0 0 6px rgba(0,230,118,0.3);
  white-space: pre;
  font-family: var(--font);
  text-align: center;
}
.phase-info-expand .scene-title {
  font-size: 10px;
  letter-spacing: 2px;
  color: var(--green-mid);
  text-transform: uppercase;
  margin-bottom: 8px;
  text-align: center;
}
.phase-info-expand .scene-desc {
  font-size: 10px;
  color: var(--green-dim);
  margin-top: 8px;
  text-align: center;
  letter-spacing: 1px;
}

/* ===========================
   [S4 U4-2] 업적 카드 CSS (v7e 기준)
   =========================== */
.ach-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  gap: 10px;
  padding: 12px;
  align-content: start;
}
.ach-card {
  border: 1px solid #0a1e0e;
  background: #010c03;
  padding: 10px 12px;
  display: flex;
  gap: 12px;
  align-items: flex-start;
  transition: border-color 0.2s, box-shadow 0.2s;
  position: relative;
}
.ach-card.earned {
  border-color: var(--green-mid);
  background: #010f04;
  box-shadow: inset 0 0 10px rgba(0,230,118,0.06), 0 0 8px rgba(0,230,118,0.1);
}
.ach-card.earned::after {
  content: '\2713';
  position: absolute;
  top: 6px;
  right: 8px;
  color: var(--green);
  font-size: 14px;
  text-shadow: var(--glow);
}
.ach-card.locked {
  opacity: 0.45;
  filter: grayscale(0.6);
}
.ach-icon {
  font-size: 20px;
  flex-shrink: 0;
  filter: drop-shadow(0 0 6px var(--amber));
}
.ach-card.locked .ach-icon {
  filter: none;
  opacity: 0.4;
}
.ach-body { flex: 1; min-width: 0; }
.ach-name {
  font-size: 12px;
  letter-spacing: 1.5px;
  margin-bottom: 3px;
  color: var(--white);
}
.ach-card.earned .ach-name {
  color: var(--amber);
  text-shadow: var(--amber-glow);
}
.ach-card.locked .ach-name { color: #2a5c35; }
.ach-desc {
  font-size: 10px;
  color: var(--green-dim);
  margin-bottom: 5px;
  line-height: 1.5;
}
.ach-card.locked .ach-desc { color: #1a3a20; }
.ach-date {
  font-size: 10px;
  color: var(--green-mid);
}
.ach-card.locked .ach-date { color: #1a3a20; }

/* ===========================
   [S4 U4-3] 프레스티지 UI CSS (v7e 기준)
   =========================== */
/* Prestige header — large card */
.prestige-header {
  border: 2px solid var(--green-dim);
  background: #010e03;
  padding: 16px 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 14px;
}
.prestige-header .ms-count {
  font-size: 22px;
  color: var(--amber);
  text-shadow: var(--amber-glow);
  letter-spacing: 2px;
}
.prestige-header .ms-label {
  font-size: 10px;
  color: var(--amber-dim);
  letter-spacing: 2px;
  text-transform: uppercase;
}
.prestige-header .reset-btn {
  padding: 8px 20px;
  font-family: var(--font);
  font-size: 13px;
  letter-spacing: 2px;
  text-transform: uppercase;
  background: rgba(255,171,0,0.08);
  border: 2px solid var(--amber);
  color: var(--amber);
  cursor: pointer;
  text-shadow: var(--amber-glow);
  transition: all 0.15s;
}
.prestige-header .reset-btn:hover:not(:disabled) {
  background: rgba(255,171,0,0.2);
  box-shadow: 0 0 12px rgba(255,171,0,0.3);
}
.prestige-header .reset-btn:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

/* Season / era badge */
.season-badge {
  border: 2px solid var(--amber);
  color: var(--amber);
  text-shadow: var(--amber-glow);
  padding: 8px 16px;
  font-size: 18px;
  letter-spacing: 3px;
  box-shadow: 0 0 12px rgba(255,171,0,0.2);
  display: inline-block;
}

/* Star upgrade tree — grid layout */
.star-tree {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 12px;
  flex-wrap: wrap;
  padding: 16px;
  background: #010a02;
  border: 1px solid #0a1e0e;
}
.star-tree-hd {
  width: 100%;
  padding: 6px 12px;
  border-bottom: 1px solid #0a1e0e;
  font-size: 10px;
  letter-spacing: 2px;
  color: var(--amber);
  text-shadow: var(--amber-glow);
  text-align: center;
}
.star-slot {
  width: 64px;
  height: 64px;
  border: 2px solid #0a2010;
  background: #010800;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  gap: 2px;
  cursor: not-allowed;
  position: relative;
  transition: border-color 0.2s, box-shadow 0.2s;
  border-radius: 50%;
}
.star-slot .slot-icon {
  font-size: 20px;
  color: #1a3a20;
}
.star-slot .slot-label {
  font-size: 7px;
  color: #1a3a20;
  letter-spacing: 1px;
  position: absolute;
  bottom: -14px;
  white-space: nowrap;
}
.star-slot.unlocked {
  border-color: var(--amber);
  background: #0a0500;
  box-shadow: 0 0 10px rgba(255,171,0,0.35), 0 0 20px rgba(255,171,0,0.15);
  cursor: default;
}
.star-slot.unlocked .slot-icon {
  color: var(--amber);
  text-shadow: var(--amber-glow);
}
.star-slot.unlocked .slot-label {
  color: var(--amber);
}
.star-slot.locked {
  border-color: #0a2010;
  background: #010800;
  opacity: 0.5;
  cursor: not-allowed;
}
.star-slot.locked .slot-icon { color: #1a3a20; }
.star-slot.locked .slot-label { color: #1a3a20; }
.star-slot.available {
  border-color: var(--amber-dim);
  cursor: pointer;
  animation: star-available-pulse 2s ease-in-out infinite;
}
@keyframes star-available-pulse {
  0%, 100% { box-shadow: 0 0 4px rgba(255,171,0,0.2); border-color: var(--amber-dim); }
  50%      { box-shadow: 0 0 14px rgba(255,171,0,0.5), 0 0 24px rgba(255,171,0,0.2); border-color: var(--amber); }
}
.star-slot.available .slot-icon { color: var(--amber-dim); }
.star-slot.available:hover {
  border-color: var(--amber);
  box-shadow: 0 0 16px rgba(255,171,0,0.5);
}
.star-connector {
  width: 24px;
  height: 2px;
  background: var(--building-roof);
}
.star-connector.active {
  background: var(--amber);
  box-shadow: 0 0 4px var(--amber);
}

/* Reset / Keep lists */
.reset-list, .keep-list {
  list-style: none;
  padding: 8px 12px;
}
.reset-list li, .keep-list li {
  font-size: 10px;
  padding: 3px 0;
  border-bottom: 1px solid #06100a;
  display: flex;
  align-items: center;
  gap: 6px;
}
.reset-list li:last-child, .keep-list li:last-child { border-bottom: none; }
.reset-list li { color: #703030; }
.reset-list li::before { content: '\2717'; color: var(--red); font-size: 11px; }
.keep-list li { color: var(--green-mid); }
.keep-list li::before { content: '\2713'; color: var(--green); font-size: 11px; }

/* Prestige history */
.prestige-history {
  border: 1px solid #0a1e0e;
  background: #010a02;
}
.prestige-history .history-hd {
  padding: 6px 12px;
  border-bottom: 1px solid #0a1e0e;
  font-size: 10px;
  letter-spacing: 2px;
  color: var(--green-dim);
}
.prestige-history .history-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 6px 12px;
  font-size: 10px;
  border-bottom: 1px solid #060e07;
}
.prestige-history .history-row:last-child { border-bottom: none; }
.prestige-history .h-season { color: var(--green); letter-spacing: 2px; }
.prestige-history .h-start  { color: var(--green-dim); }
.prestige-history .h-status {
  font-size: 10px;
  color: var(--amber);
  border: 1px solid var(--amber-dim);
  padding: 1px 6px;
  letter-spacing: 1px;
}

/* ===========================
   [S4 U4-4] 생산 탭 월드 씬 CSS 조정 (v7a 기준)
   =========================== */
/* Override production tab world-bg: full opacity, no filter */
body.tab-production #world-bg {
  opacity: 1.0;
  filter: none;
  pointer-events: auto;
  cursor: grab;
}
body.tab-production #world-bg:active { cursor: grabbing; }

/* Scrollable world container */
.world-scroll-container {
  overflow-x: auto;
  overflow-y: hidden;
  -webkit-overflow-scrolling: touch;
}
.world-scroll-container::-webkit-scrollbar { height: 6px; }
.world-scroll-container::-webkit-scrollbar-track { background: var(--bg); border-top: 1px solid var(--green-dim); }
.world-scroll-container::-webkit-scrollbar-thumb { background: var(--green-dim); border-radius: 3px; }

/* Building hover enhancement — stronger glow + info tooltip */
body.tab-production .world-bld:hover {
  color: var(--green);
  text-shadow: 0 0 14px rgba(0,230,118,0.7), 0 0 28px rgba(0,230,118,0.3);
  filter: brightness(1.3);
}
body.tab-production .world-bld:hover::after {
  content: attr(data-name);
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(1,8,0,0.95);
  border: 1px solid var(--green);
  padding: 3px 8px;
  font-size: 10px;
  color: var(--green);
  text-shadow: var(--glow);
  white-space: nowrap;
  pointer-events: none;
  z-index: 100;
  letter-spacing: 1px;
}
/* World-active class for production tab active state */
.world-active #world-bg {
  opacity: 1.0;
  filter: none;
  pointer-events: auto;
}
.world-active .world-bld {
  cursor: pointer;
}

/* ===========================
   [S4 U4-5] 리소스 바 경고 색상 CSS
   =========================== */
/* Amber fill for warning level resources */
.gfill.amber {
  background: linear-gradient(90deg, #8b6914, #ffc107, #8b6914);
  background-size: 200% 100%;
  animation: progress-shimmer 3s linear infinite;
}
.gfill.amber::after {
  background: #fff8e1;
  box-shadow: 0 0 3px rgba(255,248,225,0.7), 0 0 6px var(--amber);
}
/* Red fill for critical level resources */
.gfill.red {
  background: linear-gradient(90deg, #5c0a15, #ff1744, #5c0a15);
  background-size: 200% 100%;
  animation: progress-shimmer 2.5s linear infinite;
}
.gfill.red::after {
  background: #ffcdd2;
  box-shadow: 0 0 3px rgba(255,205,210,0.7), 0 0 6px var(--red);
}
/* "LOW" warning label badge */
.tag-low {
  display: inline-block;
  font-size: 10px;
  font-family: var(--font);
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--amber);
  border: 1px solid var(--amber-dim);
  background: rgba(255,171,0,0.08);
  padding: 1px 5px;
  vertical-align: middle;
  line-height: 1.4;
}
/* "CRITICAL" label badge — red with pulse */
.tag-crit {
  display: inline-block;
  font-size: 10px;
  font-family: var(--font);
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--red);
  border: 1px solid #5c0a15;
  background: rgba(255,23,68,0.08);
  padding: 1px 5px;
  vertical-align: middle;
  line-height: 1.4;
  animation: tag-crit-pulse 1.5s ease-in-out infinite;
}
@keyframes tag-crit-pulse {
  0%, 100% { color: var(--red); border-color: #5c0a15; text-shadow: 0 0 4px rgba(255,23,68,0.3); }
  50%      { color: #ff5252; border-color: var(--red); text-shadow: 0 0 8px rgba(255,23,68,0.6); box-shadow: 0 0 6px rgba(255,23,68,0.2); }
}

/* ===========================
   [S4 U4-6] 커서 블링크 + ERA 뱃지 CSS (v7b 기준)
   =========================== */
/* Blinking terminal cursor */
@keyframes cursor-blink-anim {
  0%, 49% { opacity: 1; }
  50%, 100% { opacity: 0; }
}
.cursor-blink {
  display: inline-block;
  width: 8px;
  height: 13px;
  background: var(--green);
  vertical-align: middle;
  animation: cursor-blink-anim 1s step-end infinite;
  box-shadow: var(--glow);
}
/* ERA badge — styled for current era in top bar */
.era-badge {
  display: inline-block;
  border: 1px solid var(--green-mid);
  padding: 2px 8px;
  color: var(--green);
  text-shadow: var(--glow);
  letter-spacing: 2px;
  font-size: 10px;
  text-transform: uppercase;
  border-radius: 0px; /* CRT — no rounded corners */
  transition: border-color 0.3s, color 0.3s;
}
/* Amber era variant */
.era-badge.amber {
  border-color: var(--amber-dim);
  color: var(--amber);
  text-shadow: var(--amber-glow);
}
/* Green era variant (default) */
.era-badge.green {
  border-color: var(--green-mid);
  color: var(--green);
  text-shadow: var(--glow);
}

/* ===========================
   [S5 U5-6] RESEARCH COMPLETE FLASH EFFECT
   =========================== */
@keyframes research-complete {
  0%  { box-shadow: 0 0 0 0 rgba(0,230,118,0); }
  30% { box-shadow: 0 0 0 12px rgba(0,230,118,0.6), 0 0 28px rgba(0,230,118,0.4); }
  60% { box-shadow: 0 0 0 24px rgba(0,230,118,0); }
  100%{ box-shadow: none; }
}
.rsh-card2.just-completed {
  animation: research-complete 0.7s ease-out forwards;
}

/* ===========================
   [S5 U5-7] IGNITION SCREEN FLASH
   =========================== */
@keyframes ignition-flash {
  0%, 100% { background: transparent; }
  10%      { background: rgba(255,171,0,0.25); }
  20%      { background: transparent; }
  30%      { background: rgba(255,171,0,0.12); }
}
body.ignition-flash::before {
  content: '';
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 9999;
  animation: ignition-flash 0.5s ease-out;
}

/* ===========================
   [S5 U5-8] HORIZON SCANLINE SWEEP
   =========================== */
@keyframes scan-sweep {
  from { transform: translateY(-100%); }
  to   { transform: translateY(100vh); }
}
#world-bg::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(180deg,
    transparent 48%,
    rgba(0,230,118,0.05) 50%,
    transparent 52%);
  animation: scan-sweep 8s linear infinite;
  pointer-events: none;
}

/* ===========================
   [S5 U5-9] CRT TERMINAL ENHANCEMENT
   =========================== */
/* A-1. 배경 깊이 그라디언트 */
#world-bg {
  background:
    radial-gradient(ellipse at 30% 20%, #002208 0%, transparent 50%),
    radial-gradient(ellipse at 70% 10%, #001a04 0%, transparent 40%),
    linear-gradient(to bottom,
      #000200  0%,
      #001a06 20%,
      #011a05 50%,
      #010900 80%,
      var(--bg) 100%);
}
/* A-4. 건물별 색상 — 산업 시설은 황록, 연구시설은 청록 */
.world-bld.wb-mine.wb-state-active,
.world-bld.wb-refinery.wb-state-active {
  color: #c8e88a;
  text-shadow: 0 0 8px rgba(160,220,80,0.5);
}
.world-bld.wb-research.wb-state-active {
  color: #88d8e0;
  text-shadow: 0 0 8px rgba(100,200,220,0.5);
}

/* ===========================
   [S5 U5-10] RESEARCH TREE TIER ARROW — RELATION LINE
   =========================== */
.rsh-tier-arrow::before {
  content: '';
  position: absolute;
  left: 0; right: 0;
  top: 50%;
  height: 1px;
  background: linear-gradient(90deg, var(--green-dim), transparent);
}

</style>
</head>
<body>

<!-- ===========================
     TITLE SCREEN
     =========================== -->
<div id="title-screen">
  <div class="title-logo">MOON IDLE</div>
  <div class="title-subtitle">달 탐사 로켓 제작소 / LUNAR EXPLORATION SIM</div>
  <div id="boot-log"></div>
  <div id="save-strip">// 저장 데이터 확인 중...</div>
  <div class="title-btns">
    <button class="title-btn primary" id="new-game-btn" style="display:none">새 게임</button>
    <button class="title-btn" id="continue-btn" style="display:none">이어하기</button>
  </div>
  <div class="title-settings">
    <button class="title-btn-sm" id="title-snd-btn">SND:ON</button>
  </div>
</div>

<!-- Save Slot Modal -->
<div id="save-slot-modal"></div>

<!-- ===========================
     WORLD BACKGROUND (fixed, z-index 0 — renders behind everything)
     =========================== -->
<div id="world-bg">
  <div id="world-scene">
    <div id="sky-layer"></div>
    <div id="buildings-layer"></div>
    <div id="ground-line"></div>
    <div id="workers-layer"></div>
  </div>
</div>

<!-- ===========================
     APP (flex column, hidden until game starts)
     =========================== -->
<div id="app">

  <!-- ══ TAB UNLOCK FLASH BANNER ══ -->
  <div id="tab-unlock-flash" class="tuf-hidden"></div>

  <!-- ══ TOP BAR ══ -->
  <div id="topbar">
    <span class="logo">&#9654; MOON IDLE</span>
    <span class="sep">—</span>
    <span class="tb-era" id="tb-era-badge" title="Current Phase">PHASE 1</span>
    <span class="sep">|</span>
    <span class="tb-subtitle" id="tb-era-subtitle">Lunar Rocket Facility</span>
    <span class="sep">|</span>
    <span class="clk" id="tb-clock">00:00:00</span>
    <span class="sep">|</span>
    <span class="mny">&#8361;&thinsp;<span id="tb-money">0</span></span>
    <span class="sep">|</span>
    <span class="sys">인원 <span id="tb-workers" style="color:var(--white)">0/0</span></span>
    <div class="tb-r">
      <button id="bgm-prev-btn" onclick="typeof BGM!=='undefined'&&BGM.next()" title="다음 BGM">BGM&#9664;&#9654;</button>
      <span id="bgm-track-label">[BGM: 앰비언트]</span>
      <button id="sound-btn">SND:ON</button>
      <button id="lang-btn" onclick="toggleLang()" title="Language / 언어">한국어</button>
    </div>
  </div>

  <!-- ══ NAV TABS (topbar 바로 아래) ══ -->
  <div id="nav-tabs">
    <button class="nav-tab active" id="nav-tab-launch" data-tab="launch" data-i18n="tab_launch">Launch Control</button>
    <button class="nav-tab" id="nav-tab-production" data-tab="production" data-i18n="tab_production">Production Hub</button>
    <button class="nav-tab" id="nav-tab-research" data-tab="research" data-i18n="tab_research">Research Lab</button>
    <button class="nav-tab" id="nav-tab-assembly" data-tab="assembly" data-i18n="tab_assembly" style="display:none">Assembly Bay</button>
    <button class="nav-tab" id="nav-tab-mission" data-tab="mission" data-i18n="tab_mission" style="display:none">Missions</button>
    <button class="nav-tab" id="nav-tab-automation" data-tab="automation" style="display:none">Automation</button>
  </div>

  <!-- ══ OFFLINE BANNER ══ -->
  <div id="offline-banner"></div>

  <!-- ══ MAIN ROW ══ -->
  <div id="main">

    <!-- ── LEFT PANEL ── -->
    <div id="res-left">
      <div id="rl-inner"></div>
      <div id="rl-ms-box"></div>
    </div>

    <!-- ── CENTER (tab area) ── -->
    <div id="ww">

      <!-- TAB CONTENT AREA -->
      <div id="tab-area">

        <!-- ===== PRODUCTION TAB ===== -->
        <div class="tab-pane" id="pane-production">
          <div id="prod-bld-panel">
            <div class="bld-list-hd">건물 리스트</div>
            <div id="prod-status"></div>
            <div id="bld-grid"></div>
            <div id="mission-goal"></div>
            <div id="milestone-panel"></div>
          </div>
        </div>

        <!-- ===== RESEARCH TAB ===== -->
        <div class="tab-pane" id="pane-research">
          <div id="research-layout">
            <div id="panel-left-research">
              <div class="r-panel-header">연구 현황</div>
              <div class="r-panel-scroll" id="research-left-content"></div>
            </div>
            <div id="panel-center-research">
              <div class="r-panel-header">기술 트리</div>
              <div id="tree-container">
                <div class="branch-headers" id="branch-headers"></div>
                <svg id="tree-svg" height="480"></svg>
              </div>
            </div>
            <div id="panel-right-research">
              <div class="r-panel-header">기술 상세</div>
              <div class="r-panel-scroll" id="research-right-content">
                <div id="tech-detail-panel"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- ===== ASSEMBLY TAB (v7c 3-column) ===== -->
        <div class="tab-pane" id="pane-assembly">

          <!-- ── LEFT: 로켓 클래스 선택 + 스펙 ── -->
          <div class="asm-col asm-col-left">
            <div class="asm-panel">
              <div class="asm-pnl-title green">// 로켓 클래스 선택</div>
              <div id="asm-class-grid"></div>
            </div>
            <div class="asm-panel">
              <div class="asm-pnl-title">// 기체 스펙</div>
              <div id="asm-class-specs"></div>
            </div>
            <div class="asm-panel">
              <div class="asm-pnl-title">// 품질 등급</div>
              <div class="quality-selector" id="quality-selector"></div>
            </div>
            <div class="asm-panel">
              <div class="asm-pnl-title">// 부품 현황</div>
              <div id="parts-checklist"></div>
            </div>
            <div class="science-box" id="science-box"></div>
          </div>

          <!-- ── CENTER: 로켓 도면 + 조립 진행 + BOM ── -->
          <div class="asm-col asm-col-center">
            <div class="rocket-art-wrap"><pre id="rocket-art-display"></pre></div>
            <div class="asm-panel">
              <div class="asm-pnl-title amber">// 조립 진행 상황</div>
              <pre id="asm-stage-progress"></pre>
            </div>
            <div class="asm-panel">
              <div class="asm-pnl-title">// BOM — 부품 목록</div>
              <div id="asm-bom-table-wrap"></div>
            </div>
          </div>

          <!-- ── RIGHT: 조립 슬롯 + 페이로드 ── -->
          <div class="asm-col asm-col-right">
            <div class="asm-panel">
              <div class="asm-pnl-title green">// 조립 슬롯</div>
              <div id="assembly-slots-wrap"></div>
            </div>
          </div>

        </div>

        <!-- ===== LAUNCH TAB (v7d 3-column) ===== -->
        <div class="tab-pane" id="pane-launch">

          <!-- ── LEFT: 체크리스트 + 조립 현황 ── -->
          <div class="lc-col lc-col-left">
            <div class="lc-panel">
              <div class="lc-pnl-title green">PRE-LAUNCH GO / NO-GO</div>
              <div id="lc-checklist"></div>
            </div>
            <div class="lc-panel">
              <div class="lc-pnl-title">// 조립 현황</div>
              <div id="lc-asm-slots"></div>
            </div>
          </div>

          <!-- ── CENTER: 로켓 아트 + 상태 바 + 실패 분석 + 커밋 박스 ── -->
          <div class="lc-col lc-col-center">
            <!-- 발사 전 정적 패널 -->
            <div id="lc-pre-launch">
              <div class="lc-rocket-disp">
                <div class="lc-rocket-art" id="lc-rocket-pre"></div>
              </div>
              <div class="lc-sbar-wrap" id="lc-sbar-wrap"></div>
              <div class="lc-fail-wrap" id="lc-fail-wrap"></div>
              <div id="lc-commit-box">
                <div class="lc-commit-hd">&#9474; LAUNCH COMMIT &#9474;</div>
                <div class="lc-commit-stats" id="lc-commit-stats"></div>
                <button id="lc-btn-launch" onclick="launchReady()" disabled>[ ··· 발사 준비 중 ··· ]</button>
                <button id="lc-btn-abort" onclick="abortAssembly()" style="display:none;">[ ABORT ]</button>
              </div>
            </div>
            <!-- 발사 애니메이션 존 (launch.js가 toggle) -->
            <div id="lc-anim-zone">
              <div class="launch-anim-wrap" id="launch-anim-wrap">
                <div style="color:var(--green-mid);font-size:13px;">// 발사 대기 중</div>
              </div>
              <div id="telem-wrap"></div>
              <div class="launch-result" id="launch-result">
                <div class="launch-result-title">발사 성공</div>
                <div class="launch-result-stats" id="lr-stats"></div>
                <div id="lr-ms" style="color:var(--amber);font-size:15px;margin-bottom:10px;"></div>
              </div>
            </div>
          </div>

          <!-- ── RIGHT: 미션 목표 + 발사 이력 + 통계 ── -->
          <div class="lc-col lc-col-right">
            <div class="lc-panel" id="lc-quest-panel">
              <div class="lc-pnl-title cyan">// MISSION OBJECTIVES</div>
              <div id="lc-quest"></div>
            </div>
            <div class="lc-panel">
              <div class="lc-pnl-title">발사 이력</div>
              <div id="lc-history"></div>
            </div>
            <div class="lc-panel">
              <div class="lc-pnl-title">통계</div>
              <div id="lc-stats-panel"></div>
            </div>
          </div>

        </div>

        <!-- ===== AUTOMATION TAB ===== -->
        <div class="tab-pane" id="pane-automation"></div>

        <!-- ===== MISSION TAB (v7e sub-tabs) ===== -->
        <div class="tab-pane" id="pane-mission">
          <!-- Sub-tabs -->
          <div id="mission-sub-tabs">
            <button class="msn-sub-tab active" data-subtab="phases" onclick="switchMissionSubTab('phases')">&#9679; 페이즈</button>
            <button class="msn-sub-tab" data-subtab="milestones" onclick="switchMissionSubTab('milestones')">&#9675; 마일스톤</button>
            <button class="msn-sub-tab" data-subtab="achievements" onclick="switchMissionSubTab('achievements')">&#9675; 업적</button>
            <button class="msn-sub-tab" data-subtab="prestige" onclick="switchMissionSubTab('prestige')">&#9675; 프레스티지</button>
          </div>
          <!-- Sub-screen: 페이즈 (P4-1 Interactive Timeline) -->
          <div class="msn-sub-screen active" id="msn-sub-phases">
            <div class="panel"><div class="panel-header">페이즈 타임라인</div><div id="phase-timeline-wrap"></div></div>
          </div>
          <!-- Sub-screen: 마일스톤 -->
          <div class="msn-sub-screen" id="msn-sub-milestones">
            <div class="panel"><div class="panel-header">마일스톤</div><div id="milestone-list-wrap"></div></div>
            <div id="ms-shop-wrap"></div>
          </div>
          <!-- Sub-screen: 업적 (P4-2) -->
          <div class="msn-sub-screen" id="msn-sub-achievements">
            <div class="panel"><div class="panel-header">업적</div><div id="achievement-list-wrap"></div></div>
          </div>
          <!-- Sub-screen: 프레스티지 (P4-3 Star Tree) -->
          <div class="msn-sub-screen" id="msn-sub-prestige">
            <div id="prestige-star-tree-wrap"></div>
          </div>
        </div>

      </div><!-- /#tab-area -->

    </div><!-- /#ww -->

    <!-- ── RIGHT PANEL ── -->
    <div id="rp">
      <div class="rph">&#9726; 인원</div>
      <div id="rp-workers">
        <div style="color:var(--green-mid);font-size:10px;line-height:1.6;padding:2px 0 8px">
          건물에 마우스를 오버하면 인원 배치 메뉴가 열립니다
        </div>
      </div>

      <div style="margin-top:8px;border-top:1px solid var(--green-dim);padding-top:8px">
        <div class="rph">&#9726; 문스톤</div>
        <div id="rp-ms" style="font-size:12px;color:var(--green-dim);margin-top:4px">아직 획득 없음</div>
      </div>

      <div style="margin-top:8px;border-top:1px solid var(--green-dim);padding-top:8px">
        <div class="rph">&#9726; 발사 기록</div>
        <div id="rp-launches" style="font-size:12px;color:var(--green-mid);margin-top:4px">0회</div>
      </div>

      <div style="margin-top:8px;border-top:1px solid var(--green-dim);padding-top:8px">
        <div class="rph">&#9726; 시스템</div>
        <div id="rp-sys" style="font-size:11px;color:var(--green);margin-top:4px">SYS: NOMINAL</div>
      </div>
    </div><!-- /#rp -->

  </div><!-- /#main -->

  <!-- ══ TICKER ══ -->
  <div id="ticker">
    <span id="tki">
      <span class="to">&gt;&gt; MOON IDLE 달 탐사 로켓 제작소 — 시스템 초기화 완료</span>
      <span class="ts">&#9632;</span>
      <span>&gt;&gt; 운영 센터에 인원을 배치하여 자금을 확보하세요</span>
      <span class="ts">&#9632;</span>
      <span class="tw">&gt;&gt; 연구소를 건설하면 연구 탭과 기술 트리가 해금됩니다</span>
      <span class="ts">&#9632;</span>
      <span>&gt;&gt; 태양광 어레이를 설치하면 전체 생산이 10%씩 증가합니다</span>
      <span class="ts">&#9632;</span>
      <span class="to">&gt;&gt; 발사대를 건설하고 로켓을 달로 쏘아올리세요!</span>
      <span class="ts">&#9632;</span>
    </span>
  </div>

</div><!-- /#app -->

<!-- ===========================
     LAUNCH OVERLAY (position:fixed)
     =========================== -->
<div id="launch-overlay">
  <div class="lo-title" id="lo-title">// 달 탐사 성공</div>
  <pre class="lo-rocket" id="lo-rocket-art"></pre>
  <div class="lo-stats" id="lo-stats"></div>
  <div class="lo-ms" id="lo-ms"></div>
  <div class="lo-btns">
    <button class="btn btn-amber" id="btn-prestige">문스톤 획득 후 재시작</button>
    <button class="btn" id="btn-continue-game">계속 진행</button>
  </div>
</div>

<!-- NOTIFICATIONS -->
<div id="notif"></div>

<!-- BUILDING HOVER OVERLAY (dynamic innerHTML via openBldOv) -->
<div id="bld-ov"></div>

<!-- RESEARCH HOVER TOOLTIP -->
<div id="tech-tip"></div>

<!-- Hidden compat elements -->
<span id="ms-display" style="display:none"></span>

<script>
// ─── TOPBAR CLOCK ─────────────────────────────────────────────
(function tickClock() {
  const t = new Date();
  const el = document.getElementById('tb-clock');
  if (el) el.textContent =
    String(t.getHours()).padStart(2,'0') + ':' +
    String(t.getMinutes()).padStart(2,'0') + ':' +
    String(t.getSeconds()).padStart(2,'0');
  setTimeout(tickClock, 1000);
})();

// ─── TOPBAR MONEY / WORKERS (reads from global gs every 500ms) ────
setInterval(function() {
  if (typeof gs === 'undefined') return;
  const m = document.getElementById('tb-money');
  if (m) m.textContent = typeof fmt === 'function' ? fmt(gs.res.money || 0) : Math.floor(gs.res.money || 0).toLocaleString('ko-KR');
  const w = document.getElementById('tb-workers');
  if (w) {
    const total = gs.workers || 1;
    const assigned = typeof getTotalAssigned === 'function' ? getTotalAssigned() : 0;
    w.textContent = assigned + '/' + total + '명';
  }
  // Right panel
  const rpMs = document.getElementById('rp-ms');
  if (rpMs) rpMs.textContent = gs.moonstone > 0 ? '&#9670; ' + gs.moonstone + ' 문스톤' : '아직 획득 없음';
  const rpLaunches = document.getElementById('rp-launches');
  if (rpLaunches) rpLaunches.textContent = (gs.launches || 0) + '회';
}, 500);
</script>

<script src="js/game-data.js"></script>
<script src="js/game-state.js"></script>
<script src="js/i18n.js"></script>
<script src="js/unlock.js"></script>
<script src="js/world.js"></script>
<script src="js/tabs/production.js"></script>
<script src="js/tabs/research.js"></script>
<script src="js/tabs/assembly.js"></script>
<script src="js/tabs/launch.js"></script>
<script src="js/tabs/mission.js"></script>
<script src="js/tabs/automation.js"></script>
<script src="js/milestones.js"></script>
<script src="js/audio-bgm.js"></script>
<script src="js/main.js"></script>
</body>
</html>
