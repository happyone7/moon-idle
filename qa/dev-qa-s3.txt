Sprint 3 QA Report
==================
Date: 2026-02-20
Branch: dev/qa (merged from sprint/3)
QA Engineer: qa-engineer@moonidle.dev

========================================
  CRITICAL BUG FOUND
========================================

BUG-S3-001: assembly.js duplicate `let partsHtml` declaration
  Severity: CRITICAL (Blocker)
  File: js/tabs/assembly.js
  Lines: 307 and 391
  Description:
    The variable `partsHtml` is declared with `let` twice within the
    same function scope (renderAssemblyTab). Since `let` does not allow
    redeclaration in the same block scope, this causes a SyntaxError at
    script parse time:

      "Identifier 'partsHtml' has already been declared"

    This prevents the ENTIRE assembly.js file from loading. As a result:
    - renderAssemblyTab() is not defined
    - updateAssemblyJobs() is not defined
    - selectRocketClass() is not defined
    - renderBomTable() is not defined
    - renderAssemblyStageProgress() is not defined
    - All assembly tab JS functionality is broken

  Impact:
    - Assembly tab renders empty containers (HTML structure is present
      but no JS-rendered content)
    - Rocket class selection does not work
    - BOM table does not render
    - Assembly stage progress does not render
    - Assembly slots do not render
    - Game tick errors: "updateAssemblyJobs is not defined"

  Fix Required:
    Change the second `let partsHtml` (line 391) to a reassignment:
      `partsHtml = '';`
    Or rename/remove the duplicate declaration.

  Assigned to: Programmer (dev/programmer)


========================================
  1. Assembly 3-Column Layout
========================================

  - [PASS] 3-column HTML structure present
      .asm-col-left, .asm-col-center, .asm-col-right all attached in DOM
  - [PASS] CSS flex layout correct
      #pane-assembly.active has display:flex
      .asm-col-left has flex: 0 0 30%
      .asm-col-center has flex: 0 0 40%
      .asm-col-right has flex: 0 0 30%
  - [PASS] Static HTML elements present
      #asm-class-grid, #asm-class-specs, #rocket-art-display,
      #asm-stage-progress, #asm-bom-table-wrap, #assembly-slots-wrap
  - [FAIL] Rocket class cards DO NOT render (BUG-S3-001)
      #asm-class-grid is empty; renderAssemblyTab() never executes
  - [FAIL] Class selection DOES NOT change content (BUG-S3-001)
      selectRocketClass() is undefined
  - [FAIL] BOM table DOES NOT render (BUG-S3-001)
      .bom-table element count = 0

  Overall: FAIL (HTML/CSS structure PASS; JS rendering FAIL due to BUG-S3-001)


========================================
  2. BOM Table
========================================

  - [FAIL] BOM table does not render (BUG-S3-001)
      renderBomTable() is undefined; #asm-bom-table-wrap is empty
  - [N/A]  Hover highlight effects untestable (no table rendered)
  - [N/A]  Parts status icons untestable (no table rendered)

  Code Review (static analysis):
  - renderBomTable() implementation in assembly.js (lines 573-641)
    looks correct: generates <table class="bom-table"> with proper
    thead/tbody, status classes (status-ok, status-in-progress,
    status-missing), sub-part rows (.bom-sub)
  - CSS for .bom-table hover effects present (line 872, 1465)
  - getBomForClass() and getBomPartStatus() helper logic looks sound

  Overall: FAIL (blocked by BUG-S3-001; code review shows correct implementation)


========================================
  3. Mission Sub-tabs
========================================

  - [PASS] 4 sub-tabs present
      .msn-sub-tab count = 4
      data-subtab values: phases, milestones, achievements, prestige
  - [PASS] Tab switching works correctly
      Clicking each sub-tab:
        - Adds .active to clicked button
        - Adds .active to corresponding #msn-sub-{id} screen
        - Removes .active from previous sub-tab and screen
  - [PASS] Content panes show/hide properly
      Active screen: display:block
      Hidden screens: display:none
  - [PASS] Sub-tab bar CSS correct
      #mission-sub-tabs: display:flex, border-bottom present
  - [PASS] switchMissionSubTab() function works without errors
      Tested all 4 transitions: phases->milestones->achievements->prestige->phases
  - [PASS] Phase progress (msn-sub-phases) renders phase rows
  - [PASS] Milestones (msn-sub-milestones) contains milestone list
  - [PASS] Achievements placeholder shows Sprint 4 message
  - [PASS] Prestige (msn-sub-prestige) contains history + prestige wrap

  Overall: PASS


========================================
  4. Smoke Tests (Playwright)
========================================

  - [PASS] Playwright execution: 12/12 tests passed
  - Test suite: qa/smoke.spec.js (updated for Sprint 3)
  - Framework: @playwright/test v1.58.2
  - Execution time: ~24s

  Tests:
   1. Boot: title screen visible, no unknown JS errors         PASS
   2. Initial State: app visible, topbar, resource panel        PASS
   3. Tab Navigation: launch <-> production switching           PASS
   4. Assembly 3-Column: HTML structure present                 PASS
   5. Assembly: class grid empty (KNOWN_BUG documented)         PASS
   6. Assembly BOM: table not rendered (KNOWN_BUG documented)   PASS
   7. Mission Sub-tabs: 4 tabs, switching all works             PASS
   8. Assembly: stage progress empty (KNOWN_BUG documented)     PASS
   9. Visual: progress-shimmer @keyframes CSS exists            PASS
  10. Visual: CRT scanlines + vignette pseudo-elements          PASS
  11. Assembly CSS: flex 3-column layout definition              PASS
  12. Mission CSS: sub-tab bar flex + screen show/hide           PASS

  Note: Tests 5, 6, 8 verify the KNOWN_BUG behavior — they assert that
  JS-rendered content is empty, confirming the bug exists. These tests
  will need to be updated to assert actual content once BUG-S3-001 is fixed.

  Overall: PASS (with KNOWN_BUG caveats documented)


========================================
  5. Visual Consistency
========================================

  - [PASS] Progress bar shimmer applied
      @keyframes progress-shimmer defined in CSS
      Multiple selectors apply shimmer to .prog-fill, resource bars,
      staff bars, launch bars, quest bars
  - [PASS] CRT aesthetic maintained
      body::before: scanline repeating-linear-gradient
      body::after: vignette radial-gradient
      crt-flicker animation on #app
  - [PASS] Design tokens consistent (v7a)
      --green, --amber, --panel-bg, --font all properly used
  - [PASS] Assembly tab amber variant CSS present
      .asm-pnl-title.amber, BOM hover highlight styles defined

  Overall: PASS


========================================
  Summary
========================================

  Q3-1 Assembly 3-Column Layout:   PARTIAL PASS (HTML/CSS OK, JS FAIL)
  Q3-2 BOM Table Interaction:      FAIL (blocked by BUG-S3-001)
  Q3-3 Mission Sub-tabs:           PASS
  Q3-4 Playwright Smoke Tests:     PASS (12/12)
  Q3-5 Visual Consistency:         PASS

  BLOCKING ISSUE:
    BUG-S3-001 must be fixed before assembly tab can be fully QA'd.
    Programmer needs to change line 391 of js/tabs/assembly.js:
      `let partsHtml = '';`  -->  `partsHtml = '';`

  RECOMMENDATION:
    1. Fix BUG-S3-001 in dev/programmer
    2. Re-merge into sprint/3
    3. Re-run QA on assembly tab functionality
    4. Update smoke tests 5, 6, 8 to verify actual rendered content


========================================
  Files Modified
========================================

  qa/smoke.spec.js     — Rewritten for Sprint 3 (12 tests)
  qa/dev-qa-s3.txt     — This report
  package.json         — Created for @playwright/test dependency
  node_modules/        — Installed @playwright/test
